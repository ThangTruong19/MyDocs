<section id="KBA-contact-index" *ngIf="labels && resource">
  <div class="container-fluid">
    <h2 class="KBA-contact-index__title KBA-page-title">{{ labels.title }}</h2>
    <div class="KBA-content">
      <!-- 代表/一般 切り替えタブ -->
      <ul class="nav nav-pills KBA-pills">
        <li class="nav-item KBA-pill-item">
          <a
            class="nav-link"
            (click)="setVisibleContactKind(ContactKind.general)"
            [ngClass]="{ active: params.contact_kind === ContactKind.general }"
          >
            {{ getContactKindLabel(ContactKind.general) }}
          </a>
        </li>
        <li class="nav-item KBA-pill-item">
          <a
            class="nav-link"
            (click)="setVisibleContactKind(ContactKind.representative)"
            [ngClass]="{
              active: params.contact_kind === ContactKind.representative
            }"
          >
            {{ getContactKindLabel(ContactKind.representative) }}
          </a>
        </li>
      </ul>

      <!-- 検索 -->
      <app-kba-accordion
        [collapsed]="collapsed"
        [useCustomHeader]="false"
        [title]="labels.search_condition"
        [isLoading]="isLoading"
        [labels]="labels"
        (onChangeState)="changePanelState($event)"
      >
        <div data-kba-accordion-body>
          <div class="container KBA-search">
            <div class="row">
              <ng-container *ngIf="resource">
                <app-kba-selected
                  *ngIf="resource.support_distributor_id"
                  class="col-sm-3"
                  [kbaName]="'support_distributor_id'"
                  [kbaParams]="params"
                  [kbaResource]="resource"
                >
                </app-kba-selected>
                <app-kba-text
                  *ngIf="resource.contact_label"
                  class="col-sm-3"
                  [kbaName]="'contact_label'"
                  [kbaParams]="params"
                  [kbaResource]="resource"
                  [customLabel]="
                    params.contact_kind === ContactKind.representative
                      ? labels.representative_contact_label
                      : null
                  "
                  [maxlength]="255"
                >
                </app-kba-text>
                <app-kba-text
                  *ngIf="resource.phone_no"
                  class="col-sm-3"
                  [kbaName]="'phone_no'"
                  [kbaParams]="params"
                  [kbaResource]="resource"
                  [customLabel]="
                    params.contact_kind === ContactKind.representative
                      ? labels.representative_phone_no
                      : null
                  "
                  [maxlength]="30"
                  [type]="'tel'"
                >
                </app-kba-text>
              </ng-container>
            </div>
          </div>
          <div class="KBA-panel-footer">
            <button
              (click)="onClickSearch()"
              type="button"
              class="btn btn-primary search"
            >
              {{ labels.search }}
            </button>
          </div>
        </div>
      </app-kba-accordion>

      <!-- ページネーション -->
      <div class="KBA-table-options" [hidden]="count <= 0">
        <app-kba-pagination
          [count]="count"
          [params]="pageParams"
          [labels]="labels"
          [element]="pageCountEl"
          (changeState)="onPaginationChange()"
        ></app-kba-pagination>
      </div>

      <!-- テーブル（一般） -->
      <app-kba-table
        [customTableRowContent]="customTableRowContent"
        [lists]="lists"
        [pageParams]="pageParams"
        [params]="params"
        [sortingParams]="sortingParams"
        [thList]="thList"
        [sortableThList]="sortableThList"
        [labels]="labels"
        [collapsed]="collapsed"
        [updatable]="updatable"
        [deletable]="deletable"
        [isFetching]="isFetching"
        (delete)="onClickDelete($event)"
        (edit)="onClickEdit($event)"
        (sort)="onChangeSort($event)"
      >
        <ng-template #customTableRowContent let-data="data">
          <ng-container *ngFor="let title of thList">
            <td
              *ngIf="title.displayable"
              [ngClass]="{
                'text-center':
                  title.name === 'contacts.general_contact.photo_exists_kind'
              }"
              class="td-{{
                title.shortName
              }} KBA-index-td d-flex align-items-center justify-content-center"
            >
              <!-- 登録画像あり の td でかつ画像が存在する場合はチェックを表示 -->
              <span
                *ngIf="
                  title.name === 'contacts.general_contact.photo_exists_kind'
                "
                [ngClass]="{
                  'kba-icon-check':
                    title.name ===
                      'contacts.general_contact.photo_exists_kind' &&
                    (data | at: title.dataKey) === PHT_DISP_CODE.exist
                }"
              >
              </span>
              <!-- それ以外は通常表示 -->
              <span
                *ngIf="
                  title.name !== 'contacts.general_contact.photo_exists_kind'
                "
              >
                {{ data | at: title.dataKey }}
              </span>
            </td>
          </ng-container>
        </ng-template>
      </app-kba-table>
    </div>
  </div>

  <ng-template #deleteModalContent>
    <app-kba-tandem-confirm
      class="confirm-modal-content"
      [desc]="deleteModalValues.listDesc"
      [val]="valItem"
    >
    </app-kba-tandem-confirm>
  </ng-template>
</section>
<app-kba-sidemenu [isLoading]="isLoading"></app-kba-sidemenu>
