<section id="KBA-landmark-form" *ngIf="!isLoading">
  <div class="container-fluid">
    <h2 class="KBA-page-title">{{ labels.title }}</h2>
    <div class="KBA-content" *ngIf="params">
      <form
        class="KBA-form"
        name="landmarkForm"
        novalidate
        [formGroup]="landmarkForm"
      >
        <p class="KBA-form-table__required">
          {{ labels.description_for_required }}
        </p>
        <table class="KBA-form-table table table-bordered">
          <tbody class="KBA-form-table-tbody">
            <!-- グループ -->
            <tr
              app-kba-form-table-select
              #groupSelect
              *ngIf="resource.landmark.group_id && !isUpdate"
              class="KBA-form-row"
              [kbaName]="'group_id'"
              [kbaParams]="params.landmark"
              [kbaResource]="resource.landmark"
              [colspan]="3"
              (onChange)="onChangeGroup($event)"
            ></tr>
            <tr *ngIf="resource.landmark.group_id && isUpdate" class="KBA-form-row">
              <td class="KBA-form-table__head">
                <label class="KBA-form-table__label">
                  {{ labels.group_label }}
                </label>
              </td>
              <td colspan="3">
                <p>{{ groupLabel }}</p>
              </td>
            <!-- ランドマーク名称 -->
            <tr
              app-kba-form-table-text
              class="KBA-form-row"
              [formGroup]="landmarkForm"
              [kbaName]="'label'"
              [kbaParams]="params.landmark"
              [kbaResource]="resource.landmark"
              [kbaLabel]="labels"
              [colspan]="3"
              [required]="true"
              [maxLength]="255"
              [path]="'landmark.label'"
              [errorData]="errorData"
            ></tr>
            <!-- アイコン -->
            <tr
              app-kba-form-table-custom
              class="KBA-form-row"
              [colspan]="3"
              [customHeader]="iconIdHeader"
              [content]="iconIdContent"
            >
              <ng-template #iconIdHeader>
                <label class="KBA-form-table__label">
                  {{ resource.landmark.icon_id.name }}
                </label>
              </ng-template>
              <ng-template #iconIdContent>
                <div class="KBA-landmark-icon">
                  <img [src]="landmarkMapData.icon.image" />
                  <a
                    href="javascript:void(0)"
                    (click)="onClickSelect($event)"
                    >{{ labels.icon_select }}</a
                  >
                  <ng-container *ngIf="iconSelectPopoverVisible">
                    <div class="popover" #iconSelectPopover>
                      <div class="popover-arrow"></div>
                      <div class="popover-content">
                        <ul>
                          <li *ngFor="let icon of iconResource">
                            <img
                              [src]="icon.image"
                              (click)="onClickIcon(icon)"
                            />
                          </li>
                        </ul>
                      </div>
                    </div>
                  </ng-container>
                </div>
              </ng-template>
            </tr>
          </tbody>
        </table>
        <div class="KBA-map">
          <app-kba-area-map
            #areaMapComponent
            [initMap]="initMapParams"
            [labels]="labels"
            [menuWidth]="0"
            [menuOpen]="false"
            [others]="landmarkList"
            [editable]="true"
            [hasMenu]="false"
            [isLandmark]="true"
            [landmarkData]="landmarkMapData"
            (changeLandmarkCoordinates)="onChangeMapCoordinates($event)"
          >
          </app-kba-area-map>
        </div>
        <table class="KBA-form-table table table-bordered">
          <tbody class="KBA-form-table-tbody">
            <tr
              app-kba-form-table-text
              class="KBA-form-row"
              [pattern]="pattern"
              [formGroup]="landmarkForm"
              [kbaName]="'lat'"
              [kbaParams]="params.landmark.point.coordinates"
              [kbaResource]="resource.landmark.point.coordinates"
              [kbaLabel]="labels"
              [colspan]="3"
              [required]="true"
              [maxLength]="12"
              [path]="'landmark.point.coordinates[1]'"
              [errorData]="errorData"
              (change)="onChangeCoordinates()"
            ></tr>
            <tr
              app-kba-form-table-text
              class="KBA-form-row"
              [pattern]="pattern"
              [formGroup]="landmarkForm"
              [kbaName]="'lng'"
              [kbaParams]="params.landmark.point.coordinates"
              [kbaResource]="resource.landmark.point.coordinates"
              [kbaLabel]="labels"
              [colspan]="3"
              [required]="true"
              [maxLength]="12"
              [path]="'landmark.point.coordinates[0]'"
              [errorData]="errorData"
              (change)="onChangeCoordinates()"
            ></tr>
            <!-- 説明 -->
            <tr
              app-kba-form-table-textarea
              class="KBA-form-row"
              [formGroup]="landmarkForm"
              [kbaName]="'free_memo'"
              [kbaParams]="params.landmark"
              [kbaResource]="resource.landmark"
              [kbaLabel]="labels"
              [colspan]="3"
              [maxLength]="1024"
              [path]="'landmark.free_memo'"
              [errorData]="errorData"
            ></tr>
            <!-- 公開種別 -->
            <tr
              app-kba-form-table-custom
              *ngIf="exists('landmark.publish_kind')"
              class="KBA-form-row"
              [kbaResource]="resource.landmark"
              [kbaName]="'publish_kind'"
              [content]="publishKindContent"
            >
              <ng-template #publishKindContent>
                <div [formGroup]="landmarkForm">
                  <ng-container
                    *ngFor="
                      let radio of (resource | at: 'landmark.publish_kind')
                        .values
                    "
                  >
                    <input
                      id="publish-kind-{{ radio.value }}"
                      type="radio"
                      class="KBA-input-radio"
                      name="publishKind"
                      [value]="radio.value"
                      [(ngModel)]="params.landmark.publish_kind"
                      [ngModelOptions]="{ standalone: true }"
                    />
                    <label
                      for="publish-kind-{{ radio.value }}"
                      class="KBA-input-radio__label"
                    >
                      {{ radio.name }}
                    </label>
                  </ng-container>
                </div>
              </ng-template>
            </tr>
          </tbody>
        </table>

        <footer class="KBA-form-footer-fixed">
          <a
            href="javascript:void(0)"
            (click)="onClickReset()"
            class="btn btn-link"
          >
            {{ labels.reset }}
          </a>
          <button
            class="btn btn-success"
            type="button"
            *ngIf="!isUpdate"
            (click)="onClickContinue()"
            [disabled]="!landmarkForm.valid"
          >
            {{ labels.continue }}
          </button>
          <button
            class="btn btn-primary"
            type="button"
            (click)="onClickSubmit()"
            [disabled]="!landmarkForm.valid"
          >
            {{ labels.submit }}
          </button>
        </footer>
      </form>
    </div>
  </div>

  <ng-template #resetModalContent>
    <p class="KBA-modal-message">{{ labels.reset_modal_body }}</p>
  </ng-template>
</section>

<app-kba-sidemenu [isLoading]="isLoading"></app-kba-sidemenu>
