<section id="KBA-garea-form" *ngIf="!isLoading">
  <div class="container-fluid">
    <h2 class="KBA-area-new__title KBA-page-title">{{ labels.title }}</h2>

    <div class="KBA-content" *ngIf="params">
      <form class="KBA-form" name="areaForm" novalidate [formGroup]="areaForm">
        <p class="KBA-form-table__required">
          {{ labels.description_for_required }}
        </p>
        <table class="KBA-form-table table table-bordered">
          <tbody class="KBA-form-table-tbody">
            <tr
              app-kba-form-table-select
              #groupSelect
              *ngIf="resource.group_area.group_id && !isUpdate"
              class="KBA-form-row"
              [kbaName]="'group_id'"
              [kbaParams]="params"
              [kbaResource]="resource.group_area"
              [colspan]="3"
              [emitInitialRefresh]="false"
              (onChange)="onChangeGroup($event)"
            ></tr>
            <tr *ngIf="resource.group_area.group_id && isUpdate" class="KBA-form-row">
              <td class="KBA-form-table__head">
                <label class="KBA-form-table__label">
                  {{ labels.group_label }}
                </label>
              </td>
              <td>
                <p>{{ groupLabel }}</p>
              </td>
            </tr>
            <tr
              app-kba-form-table-text
              class="KBA-form-row"
              [formGroup]="areaForm"
              [kbaName]="'label'"
              [kbaParams]="params"
              [kbaResource]="resource.group_area"
              [kbaLabel]="labels"
              [colspan]="3"
              [required]="true"
              [maxLength]="64"
              [path]="'group_area.label'"
              [errorData]="errorData"
            ></tr>
          </tbody>
        </table>
        <div class="KBA-map">
          <app-kba-area-menu
            [formGroup]="areaForm"
            [initMap]="initMap"
            [resource]="resource"
            [resourceType]="'group_area'"
            [menuOpen]="menuOpen"
            [isCurrent]="true"
            [pointNum]="pointNum"
            [selectType]="selectType"
            [typeResourceValues]="
              resource.group_area.feature.geometry.type.values
            "
            [labels]="labels"
            [editable]="true"
            [polyPoints]="polyPoints"
            [rectData]="rectData"
            [errorData]="errorData"
            (delPolyPoint)="onChangePoints($event)"
            (changeMenuOpen)="menuOpen = $event"
            (changeSelectType)="onChangeSelectType($event)"
          >
          </app-kba-area-menu>
          <app-kba-area-map
            #areaMapComponent
            [initMap]="initMap"
            [labels]="labels"
            [others]="others"
            [params]="params"
            [menuWidth]="312"
            [menuOpen]="menuOpen"
            [selectType]="selectType"
            [polyPoints]="polyPoints"
            [rectData]="rectData"
            [editable]="true"
            [isUpdate]="isUpdate"
            (changePoints)="onChangePoints($event)"
            (changeRect)="onChangeRect($event)"
          >
          </app-kba-area-map>
        </div>
        <table class="KBA-form-table table table-bordered">
          <tbody class="KBA-form-table-tbody">
            <tr
              app-kba-form-table-custom
              [kbaName]="'area_option'"
              [kbaResource]="resource.group_area"
              [customHeader]="haeder"
              [content]="content"
            >
              <ng-template #haeder>
                <label class="KBA-form-table__label">
                  {{ labels.option }}
                </label>
              </ng-template>
              <ng-template #content>
                <ul *ngIf="notEditable">
                  <li *ngFor="let data of viewData()">{{ data[item] }}</li>
                </ul>
                <div *ngIf="!notEditable" class="form-group">
                  <ul class="KBA-toggle-buttons">
                    <li *ngFor="let o of areaOptions">
                      <button
                        (click)="onClickOption(o)"
                        [ngClass]="{ 'KBA-toggle-button__on': hasOption(o) }"
                        class="btn"
                        type="button"
                      >
                        {{ resource.group_area[o].name }}
                      </button>
                    </li>
                  </ul>
                </div>
              </ng-template>
            </tr>
            <tr
              app-kba-form-table-textarea
              class="KBA-form-row"
              [formGroup]="areaForm"
              [kbaName]="'description'"
              [kbaParams]="params"
              [kbaResource]="resource.group_area"
              [kbaLabel]="labels"
              [colspan]="3"
              [maxLength]="255"
              [path]="'group_area.description'"
              [errorData]="errorData"
            ></tr>
            <tr
              app-kba-form-table-select
              #groupAreaNoSelect
              class="KBA-form-row"
              [kbaName]="'no'"
              [kbaParams]="params"
              [kbaResource]="resource.group_area"
              [colspan]="3"
            ></tr>
          </tbody>
        </table>

        <footer class="KBA-form-footer-fixed">
          <a
            href="javascript:void(0)"
            (click)="onClickReset()"
            class="btn btn-link"
          >
            {{ labels && labels.reset }}
          </a>
          <button
            class="btn btn-success"
            type="button"
            *ngIf="!isUpdate"
            (click)="onClickContinue()"
            [disabled]="!areaForm.valid || isLimit"
          >
            {{ labels && labels.continue }}
          </button>
          <button
            class="btn btn-primary"
            type="button"
            (click)="onClickSubmit()"
            [disabled]="
              !areaForm.controls.coordinates.valid || !areaForm.valid || isLimit
            "
          >
            {{ labels && labels.submit }}
          </button>
        </footer>
      </form>
    </div>
  </div>

  <ng-template #submitModalContent>
    <app-kba-tandem-confirm
      class="confirm-modal-content"
      [desc]="descItem"
      [val]="params"
    >
    </app-kba-tandem-confirm>
  </ng-template>

  <ng-template #resetModalContent>
    <p class="KBA-modal-message">{{ labels.reset_modal_body }}</p>
  </ng-template>
</section>
<app-kba-sidemenu [isLoading]="isLoading"></app-kba-sidemenu>
<app-kba-alert></app-kba-alert>
