<section id="KBA-contact-form" *ngIf="labels && resource">
  <div class="container-fluid" [hidden]="loading">
    <h2 class="KBA-page-title">{{ labels && labels.title }}</h2>

    <div class="KBA-content">
      <form
        class="KBA-form"
        name="contactForm"
        novalidate
        [formGroup]="contactForm"
      >
        <div class="annotation">
          <p class="KBA-form-table__required">
            {{ labels && labels.description_for_required }}
          </p>
          <div
            class="KBA-valid-errors"
            *ngIf="params.contact.kind === ContactKind.general"
          >
            <p>{{ labels.valid_composite_contract_required }}</p>
          </div>
        </div>
        <table class="KBA-form-table table table-bordered" *ngIf="!loading">
          <tbody class="KBA-form-table-tbody">
            <tr class="KBA-form-row">
              <td class="KBA-form-table__head">
                <label class="KBA-form-table__label require">{{
                  resource.contact.kind.name
                }}</label>
              </td>
              <td colspan="3">
                <div class="KBA-form-select-kind">
                  <ng-container *ngIf="!isUpdate">
                    <div class="kind kind-general">
                      <input
                        name="contact_kind"
                        id="KBA-form-select-kind__kind-general"
                        type="radio"
                        class="KBA-input-radio"
                        [ngModelOptions]="{ standalone: true }"
                        [value]="ContactKind.general"
                        [checked]="params.contact.kind === ContactKind.general"
                        [ngModel]="params.contact.kind"
                        (ngModelChange)="onSelectContactKind($event)"
                      />
                      <label
                        for="KBA-form-select-kind__kind-general"
                        class="KBA-input-radio__label"
                      >
                        {{ getContactKindResouce(ContactKind.general).name }}
                      </label>
                    </div>
                    <div class="kind kind-representative">
                      <input
                        name="contact_kind"
                        id="KBA-form-select-kind__kind-representative"
                        type="radio"
                        class="KBA-input-radio"
                        [ngModelOptions]="{ standalone: true }"
                        [value]="ContactKind.representative"
                        [checked]="
                          params.contact.kind === ContactKind.representative
                        "
                        [ngModel]="params.contact.kind"
                        (ngModelChange)="onSelectContactKind($event)"
                      />
                      <label
                        for="KBA-form-select-kind__kind-representative"
                        class="KBA-input-radio__label"
                      >
                        {{
                          getContactKindResouce(ContactKind.representative).name
                        }}
                      </label>
                    </div>
                  </ng-container>
                  <ng-container *ngIf="isUpdate">
                    <div class="kind">
                      <span
                        *ngIf="
                          params.contact.kind === ContactKind.representative
                        "
                      >
                        {{
                          getContactKindResouce(ContactKind.representative).name
                        }}
                      </span>
                      <span *ngIf="params.contact.kind === ContactKind.general">
                        {{ getContactKindResouce(ContactKind.general).name }}
                      </span>
                    </div>
                  </ng-container>
                </div>
              </td>
            </tr>
            <tr
              app-kba-form-table-select
              class="KBA-form-row"
              [kbaName]="'support_distributor_id'"
              [kbaParams]="params.contact"
              [kbaResource]="resource.contact"
              [colspan]="3"
              [display]="'support_distributor_label'"
              [notEditable]="isUpdate"
            ></tr>
            <ng-container
              *ngIf="params.contact.kind === ContactKind.representative"
            >
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.representative"
                [kbaName]="'label'"
                [kbaParams]="params.contact.represent_contact"
                [kbaResource]="resource.contact.represent_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="true"
                [maxLength]="255"
                [path]="'contact.represent_contact.label'"
                [errorData]="errorData"
              ></tr>
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.representative"
                [kbaName]="'phone_no'"
                [kbaParams]="params.contact.represent_contact"
                [kbaResource]="resource.contact.represent_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="true"
                [maxLength]="30"
                [path]="'contact.represent_contact.phone_no'"
                [errorData]="errorData"
              ></tr>
            </ng-container>
            <ng-container *ngIf="params.contact.kind === ContactKind.general">
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.general"
                [kbaName]="'label'"
                [kbaParams]="params.contact.general_contact"
                [kbaResource]="resource.contact.general_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="true"
                [maxLength]="255"
                [path]="'contact.general_contact.label'"
                [errorData]="errorData"
              ></tr>
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.general"
                [kbaName]="'email'"
                [kbaParams]="params.contact.general_contact"
                [kbaResource]="resource.contact.general_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="false"
                [maxLength]="255"
                [path]="'contact.general_contact.email'"
                [errorData]="errorData"
                (change)="checkExistGeneralContact()"
              ></tr>
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.general"
                [kbaName]="'office_phone_no'"
                [kbaParams]="params.contact.general_contact"
                [kbaResource]="resource.contact.general_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="false"
                [maxLength]="30"
                [path]="'contact.general_contact.office_phone_no'"
                [errorData]="errorData"
                (change)="checkExistGeneralContact()"
              ></tr>
              <tr
                app-kba-form-table-text
                class="KBA-form-row"
                [formGroup]="contactForm.controls.general"
                [kbaName]="'cell_phone_no'"
                [kbaParams]="params.contact.general_contact"
                [kbaResource]="resource.contact.general_contact"
                [kbaLabel]="labels"
                [colspan]="3"
                [required]="false"
                [maxLength]="30"
                [path]="'contact.general_contact.cell_phone_no'"
                [errorData]="errorData"
                (change)="checkExistGeneralContact()"
              ></tr>
              <tr class="KBA-form-row">
                <td class="KBA-form-table__head">
                  <label class="KBA-form-table__label require">{{
                    resource.contact.general_contact.photo.image.name
                  }}</label>
                </td>
                <td class="KBA-has-error photo" colspan="3">
                  <label>
                    <span class="btn btn-secondary">
                      {{ labels.select_file }}
                      <input
                        type="file"
                        accept=".bmp,image/gif,image/jpeg"
                        (change)="onSelectPhotoFile($event.target)"
                      />
                    </span>
                  </label>
                  <div class="image-notices">
                    <p>{{ labels.notice_file_size }}</p>
                    <p>{{ labels.notice_file_length }}</p>
                    <p>{{ labels.notice_file_format }}</p>
                  </div>
                  <div class="image-area" *ngIf="croppedImageSrc">
                    <img
                      class="photo-image"
                      [src]="croppedImageSrc | sanitizeUrl"
                    />
                    <div
                      class="btn btn-secondary delete-area"
                      (click)="onClickDeletePhoto()"
                    >
                      <span class="kba-icon kba-icon-dustbox"></span>
                      <p>{{ labels.delete_photo }}</p>
                    </div>
                  </div>
                </td>
              </tr>
            </ng-container>
          </tbody>
        </table>

        <footer class="KBA-form-footer-fixed">
          <a
            href="javascript:void(0)"
            (click)="onClickReset()"
            class="btn btn-link"
          >
            {{ labels && labels.reset }}
          </a>
          <button
            class="btn btn-success"
            type="button"
            *ngIf="!isUpdate"
            (click)="onClickContinue()"
            [disabled]="
              !contactForm.controls[_getContactKindText(params.contact.kind)]
                .valid ||
              (params.contact.kind === ContactKind.general &&
                !existGeneralContact)
            "
          >
            {{ labels && labels.continue }}
          </button>
          <button
            class="btn btn-primary"
            type="button"
            (click)="onClickSubmit()"
            [disabled]="
              !contactForm.controls[_getContactKindText(params.contact.kind)]
                .valid ||
              (params.contact.kind === ContactKind.general &&
                !existGeneralContact)
            "
          >
            {{ labels && labels.submit }}
          </button>
        </footer>
      </form>
    </div>
  </div>

  <ng-template #submitModalContent>
    <app-kba-tandem-confirm
      class="confirm-modal-content"
      [desc]="descItem"
      [val]="valItem"
      [customContent]="customFormConfirmContent"
    >
      <ng-template
        class="custom-confirm"
        #customFormConfirmContent
        let-d="d"
        let-value="value"
      >
        <p
          class="confirm-value"
          *ngIf="d.name !== 'contact.general_contact.photo.image'"
        >
          {{ value }}
        </p>
        <img
          *ngIf="
            d.name == 'contact.general_contact.photo.image' && croppedImageSrc
          "
          class="photo-image"
          [src]="croppedImageSrc | sanitizeUrl"
        />
        <p
          *ngIf="
            d.name == 'contact.general_contact.photo.image' && !croppedImageSrc
          "
        >
          {{ labels.no_registered }}
        </p>
      </ng-template>
    </app-kba-tandem-confirm>
  </ng-template>

  <ng-template #resetModalContent>
    <p class="KBA-modal-message">{{ labels.reset_modal_body }}</p>
  </ng-template>

  <ng-template #deleteImageModalContent>
    <p class="KBA-modal-message">{{ labels.delete_image_modal_body }}</p>
  </ng-template>
</section>

<app-kba-sidemenu [isLoading]="isLoading"></app-kba-sidemenu>
