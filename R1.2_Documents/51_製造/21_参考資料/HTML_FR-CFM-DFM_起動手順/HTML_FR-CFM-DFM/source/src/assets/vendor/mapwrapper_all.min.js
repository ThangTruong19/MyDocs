/*
 * komtrax-map
 * 1.4.13
 */

"use strict";var _createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},MapScriptLoader=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{loaderErrorStatus:{value:function(e){return{LOAD_FAILED_GOOGLEMAPS:"Load failed : Google Mpas Javascript API",LOAD_FAIELD_CSS:"Load failed : css file ( "+e+")",LOAD_FAILED_SCRIPT:"Load failed : JavaScript Library ("+e+")",LOAD_LAILED_MAPAPI:"Loaad failed: Map API"}}},loadLibraries:{value:function(t){var r=this;return"GoogleMapPlugin"==t.pluginName?this.loadGoogleMapApiScript(t.apikey,t.lang,t.apiurl).then(function(){return $.when(r.loadAllScripts(t.pluginscripts),r.loadAllCss(t.plugincss))}):this.loadJs(t.apiurl).then(function(){return e.loadCss(t.apicss)}).then(function(){return $.when(e.loadAllScripts(t.pluginscripts),e.loadAllCss(t.plugincss))})}},loadAllScripts:{value:function(t){var r=$.Deferred();if(!Array.isArray(t)||t.length<=0)return r.resolve(),r.promise();var n=t.map(function(t){return function(){return e.loadJs(t)}});return n.reduceRight(function(e,t){return function(){return t().then(e)}})().then(function(){return r.resolve()}),r.promise()}},loadJs:{value:function(t){var r=$.Deferred();t||r.resolve();var n=$("<script>");return n.load(function(){r.resolve()}),n.on("error",function(){r.reject(e.loaderErrorStatus(t).LOAD_FAILED_SCRIPT)}),n.attr("src",t),$("head").get(0).appendChild(n.get(0)),r.promise()}},loadAllCss:{value:function(t){var r=$.Deferred();if(!Array.isArray(t)||t.length<=0)return r.resolve(),r.promise();var n=[];return t.forEach(function(t){n.push(e.loadCss(t))}),$.when.apply(null,n).then(function(){r.resolve()}),r.promise()}},loadCss:{value:function(t){var r=$.Deferred(),n=$("<link>");return n.attr({href:t,rel:"stylesheet",type:"text/css"}),$("head").get(0).appendChild(n.get(0)),n.load(function(){r.resolve()}),n.on("error",function(){r.reject(e.loaderErrorStatus(t).LOAD_FAIELD_CSS)}),setTimeout(function(){r.resolve()},1e3),r.promise()}},loadGoogleMapApiScript:{value:function(){var t=this,r=void 0===arguments[0]?null:arguments[0],n=void 0===arguments[1]?null:arguments[1],a=void 0===arguments[2]?"//maps.googleapis.com/maps/api/js?libraries=geometry&callback=mapapiscript_loaded":arguments[2];if(this.deferred)return this.deferred.promise();this.deferred=$.Deferred();var o=$("<script>"),i=a;return r&&(i+="&"+r),n&&(i+="&language="+n),window.mapapiscript_loaded=function(){t.deferred.resolve()},o.on("error",function(){t.deferred.reject(e.loaderErrorStatus().LOAD_FAILED_GOOGLEMAPS)}),o.attr("src",i),$("head").get(0).appendChild(o.get(0)),this.deferred.promise()}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},MapWrapperError=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{Error:{value:function(e){var t=function(t,r){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e,t){var r=new Error(e);return _.extend(r,t),r})},routingErrorStatus:{get:function(){return{NOT_FOUND:"NOT_FOUND",ZERO_RESULTS:"ZERO_RESULTS",MAX_WAYPOINTS_EXCEEDED:"MAX_WAYPOINTS_EXCEEDED",INVALID_REQUEST:"INVALID_REQUEST",OVER_QUERY_LIMIT:"OVER_QUERY_LIMIT",REQUEST_DENIED:"REQUEST_DENIED",UNKNOWN:"UNKNOWN",CONNECTION_FAILED:"CONNECTION_FAILED"}}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},MapWrapper=function(){function e(t){_classCallCheck(this,e),this.config=t,this.pluginName=this.config.pluginName,this.setPlugin()}return _createClass(e,{Map:{value:function(e,t){var r=void 0===arguments[2]?null:arguments[2];this.mapplugin.Map(e,t,r)}},loadScript:{value:function(){return this.loaderdeferred?this.loaderdeferred.promise():(this.loaderdeferred=$.Deferred(),this.loadApi(),this.loaderdeferred.promise())}},loadApi:{value:function(){var e=this;this.setPlugin();var t=this.mapplugin.loadApiScript();t.then(function(){e.loaderdeferred.resolve()},function(t){e.loaderdeferred.reject(t)})}},setPlugin:{value:function(){this.mapplugin=new window[this.pluginName](this.config)}},remove:{value:function(){this.mapplugin.remove()}},fitBounds:{value:function(e){this.mapplugin.fitBounds(e)}},fitBoundsWithMaxZoom:{value:function(e,t){this.mapplugin.fitBoundsWithMaxZoom(e,t)}},createBounds:{value:function(e){return this.mapplugin.createBounds(e)}},setZoom:{value:function(e){this.mapplugin.setZoom(e)}},getZoom:{value:function(){return this.mapplugin.getZoom()}},setCenter:{value:function(e){this.mapplugin.setCenter(e)}},getCenter:{value:function(){return this.mapplugin.getCenter()}},addLayer:{value:function(e){e=e.overlay?e.overlay:e,this.mapplugin.addLayer(e)}},removeLayer:{value:function(e){e=e.overlay?e.overlay:e,this.mapplugin.removeLayer(e)}},drawCarMarker:{value:function(e,t){if(!t&&e.position){var r=e,n=['<div class="KBA-carMapIcon">','    <span class="KBA-carMapIcon__icon KBA-carMapIcon__icon--<%= iconColor %> KBA-icon-car<%= iconId %>"></span>','    <span class="KBA-carMapIcon__date KBA-carMapIcon__date--<%= iconColor %>"><%= time %></span>',"</div>"].join("\n"),n=_.template(n);t=n(r),e=e.position}return this.mapplugin.drawCarMarker(e,t)}},addClassToCarMarker:{value:function(e,t){this.mapplugin.addClassToCarMarker(e,t)}},removeClassFromCarMarker:{value:function(e,t){this.mapplugin.removeClassFromCarMarker(e,t)}},removeCarMarker:{value:function(e){this.mapplugin.removeCarMarker(e)}},removeCarMarkers:{value:function(){this.mapplugin.removeCarMarkers()}},drawLandmarks:{value:function(e,t){var r=this,n=void 0!==arguments[2]&&arguments[2],a=[];return e.forEach(function(e){a.push(r.drawLandmark(e,t,n))}),a}},drawLandmark:{value:function(e,t){var r=void 0!==arguments[2]&&arguments[2];return"boolean"==typeof t&&(r=t,t=""),t||(t="KBA-landmarkIcon__label"),e.iconUrl||(e.iconUrl=r?this.config.landmarkretinaicondir+"/"+e.imgpath:this.config.landmarkicondir+"/"+e.imgpath),this.mapplugin.drawLandmark(e,t)}},removeLandmark:{value:function(e){this.mapplugin.removeLandmark(e)}},removeLandmarks:{value:function(){this.mapplugin.removeLandmarks()}},toggleShowLandmarks:{value:function(e){this.mapplugin.toggleShowLandmarks(e)}},createAreaOverlays:{value:function(e,t){var r=function(e){if(e.infoWindow)return e.infoWindow;var t=e.Desc?"<h3>"+e.Desc+"</h3>":"",r=e.Expl?"<p>"+e.Expl+"</p>":"";return""+t+r},n=e.map(function(e){return e.infoWindow=r(e),e.infoWindowAutoPan=e.infoWindowAutoPan!==!1,e});return this.mapplugin.createAreaOverlays(n,t)}},createAreaOverlay:{value:function(e,t){var r=function(e){if(e.infoWindow)return e.infoWindow;var t=e.Desc?"<h3>"+e.Desc+"</h3>":"",r=e.Expl?"<p>"+e.Expl+"</p>":"";return""+t+r};return e.infoWindow=r(e),e.infoWindowAutoPan=e.infoWindowAutoPan!==!1,this.mapplugin.createAreaOverlay(e,t)}},addAreaOverlay:{value:function(e){return e=e.overlay?e.overlay:e,this.mapplugin.addLayer(e)}},removeAreaOverlay:{value:function(e){return e=e.overlay?e.overlay:e,this.mapplugin.removeLayer(e)}},setDrawMode:{value:function(e){var t=void 0===arguments[1]?{strokeColor:"#ff0000",strokeOpacity:.5,strokeWeight:2,fillColor:"#ff0000",fillOpacity:.2}:arguments[1];return this.mapplugin.setDrawMode(e,t)}},unsetDrawMode:{value:function(){return this.mapplugin.unsetDrawMode()}},getAreasInfo:{value:function(){return this.mapplugin.getAreasInfo()}},getAreaInfo:{value:function(e){return this.mapplugin.getAreaInfo(e)}},getAreasBounds:{value:function(e){return this.mapplugin.getAreasBounds(e)}},drawRoute:{value:function(e,t,r,n,a){var o={origin:{show:!0},dest:{show:!1}},i="null",s="DRIVING",l=o;return r&&("object"!=typeof r||r.container&&r.container instanceof HTMLElement?r.container&&r.container instanceof HTMLElement?(i=r,"string"==typeof n&&(s=n)):"string"==typeof r&&(s=r):(l=0===Object.keys(r).length?o:r,n&&n.container&&n.container instanceof HTMLElement?(i=n,"string"==typeof a&&(s=a)):"string"==typeof n&&(s=n))),this.mapplugin.drawRoute(e,t,l,i,s)}},getRouteSearchMethod:{value:function(){return this.mapplugin.getRouteSearchMethod()}},removeRoute:{value:function(){return this.mapplugin.removeRoute()}},hasTrafficLayer:{value:function(){return this.mapplugin.hasTrafficLayer()}},createTrafficLayer:{value:function(){if(this.hasTrafficLayer())return this.mapplugin.createTrafficLayer()}},removeTrafficLayer:{value:function(){return!!this.hasTrafficLayer()&&void this.mapplugin.removeTrafficLayer()}},loadClustererApi:{value:function(){var e=this.mapplugin.loadMarkerClusterer();return e}},clusterMarkersAll:{value:function(e,t,r,n,a,o,i){var s=(void 0===arguments[7]?{zoom:8}:arguments[7],void 0===arguments[8]||arguments[8]),l=void 0===arguments[9]?"clustermarker-caption-label":arguments[9];t.isAdapted||(t=this._adaptClusterData(t)),this._clusterFitBounds(e,t,r,n),this.clusterMarkers(t,a,o,i,s=!0,l)}},_clusterFitBounds:{value:function(e,t,r,n){if(n){if(r&&e>r){if(this.setZoom(defaultBounds.zoom),defaultBounds.center)return void this.setCenter(defaultBounds.center);for(var a,o=0;;){if(a=data[o].latLng,null!==a.lat&&null!==a.lng)break;o++}return void this.setCenter(a)}var i=[];t.forEach(function(e){e.latLng&&e.latLng.lat&&e.latLng.lng&&i.push(e.latLng)}),this.fitBounds(this.createBounds(i))}}},clusterMarkers:{value:function(e){var t=void 0===arguments[1]?null:arguments[1],r=void 0===arguments[2]?null:arguments[2],n=void 0===arguments[3]||arguments[3],a=void 0===arguments[4]||arguments[4],o=void 0===arguments[5]?"clustermarker-caption-label":arguments[5],i=this._getCallBackArg(r);e.isAdapted||(e=this._adaptClusterData(e)),this.mapplugin.clusterMarkers(e,t,i,n,a,o)}},_getCallBackArg:{value:function(e){var t=null;return"function"==typeof e?t={"submit-":e}:"object"==typeof e&&(t=e),t}},_adaptClusterData:{value:function(e){var t=this;return e.map(function(e){return _.assign(e,{latLng:t._getLatLng(e),iconUrl:t._getIconUrl(e)})}),e.isAdapted=!0,e}},_getLatLng:{value:function(e){if(e.latLng)return e.latLng;if(e.Lat&&e.Lon)return{lat:e.Lat,lng:e.Lon}}},_getIconUrl:{value:function(e){return e.iconUrl?e.iconUrl:this.config.pngicondir&&e.iconName&&e.IcnFnt?this.config.pngicondir+e.iconName+e.IcnFnt+".png":void 0}},_getTargetIconUrl:{value:function(e){if(this.config.pngtargeticondir&&e.iconName&&e.IcnFnt)return this.config.pngtargeticondir+e.iconName+e.IcnFnt+".png"}},getMarkerInClusterByMId:{value:function(e){return this.mapplugin.getMarkerInClusterByMId(e)}},markerClusterRedraw:{value:function(){return this.mapplugin.markerClusterRedraw()}},toggleClusterMarkerCaption:{value:function(){this.mapplugin.toggleClusterMarkerCaption()}},setMarkerBlink:{value:function(e){this.mapplugin.setMarkerBlink(e)}},stopMarkerBlink:{value:function(e){this.mapplugin.stopMarkerBlink(e)}},stopAllMarkerBlink:{value:function(){this.mapplugin.stopAllMarkerBlink()}},setTargetIcon:{value:function(e,t){this.mapplugin.setTargetIcon(e,t)}},removeTargetIcon:{value:function(e){this.mapplugin.removeTargetIcon(e)}},removeAllTargetIcons:{value:function(){this.mapplugin.removeAllTargetIcons()}},clearMarkers:{value:function(){this.mapplugin.clearMarkers()}},getBounds:{value:function(){return this.mapplugin.getBounds()}},onBoundsChange:{value:function(){var e=void 0===arguments[0]?null:arguments[0],t=this.mapplugin.getBounds();if(!t)return!1;var r={NE:{Lat:t.ne.lat,Lon:t.ne.lng},SW:{Lat:t.sw.lat,Lon:t.sw.lng}};e&&e({bounds:r})}},addListener:{value:function(e,t){return this.mapplugin.addListener(e,t)}},addListenerOnce:{value:function(e,t){return this.mapplugin.addListenerOnce(e,t)}},removeAllListners:{value:function(e){return this.mapplugin.removeAllListener(e)}},changeCursor:{value:function(e){return this.mapplugin.changeCursor(e)}},resetCursor:{value:function(){return this.mapplugin.resetCursor()}},addMapClickListener:{value:function(e){return this.mapplugin.addMapClickListener(e)}},removeMapClickListener:{value:function(e){return this.mapplugin.removeMapClickListener(e)}},redraw:{value:function(){this.mapplugin.redraw()}},redrawRoute:{value:function(){this.mapplugin.redrawRoute()}},trigger:{value:function(e){this.mapplugin.trigger(e)}},map:{get:function(){if(this.mapplugin)return this.mapplugin.map}},landmarks:{get:function(){return this.mapplugin.landmarks}},markerCluster:{get:function(){if(this.mapplugin&&this.mapplugin.cluster)return this.mapplugin.cluster}},areaObjects:{get:function(){return this.mapplugin.areaObjects}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},GoogleMapPlugin=function(){function e(t){_classCallCheck(this,e),this.AREAS_CHANGED="AREAS_CHANGED",this.ROUTE_SEARCH_CANCELD="ROUTE_SEARCH_CANCELD",this.DEFAULT_ICON_SIZE=[32,32],this.isShowLandmark=!0,this.blinkMarkerV=.02,this.config=t,this.targetMarkers=[]}return _createClass(e,{loadApiScript:{value:function(){var e=this;return MapScriptLoader.loadGoogleMapApiScript(this.config.apikey,this.config.lang,this.config.apiurl).then(function(){return $.when(MapScriptLoader.loadAllScripts(e.config.pluginscripts),MapScriptLoader.loadAllCss(e.config.plugincss))})}},Map:{value:function(e,t,r){return"HYBRID"===t.mapType&&(t.mapTypeId=google.maps.MapTypeId.HYBRID),t.scaleControl=!0,t.staticMap&&_.extend(t,{disableDefaultUI:!0,gestureHandling:"none"}),this.options=t,this.map=new google.maps.Map(e,t),this}},remove:{value:function(){for(var e=this.map.getDiv();e.firstChild;)e.removeChild(e.firstChild);delete this.map}},fitBounds:{value:function(e){if("function"==typeof e.getSouthWest)this.map.fitBounds(e);else{var t=new google.maps.LatLng(e.sw.lat,e.sw.lng),r=new google.maps.LatLng(e.ne.lat,e.ne.lng);this.map.fitBounds(new google.maps.LatLngBounds(t,r))}}},fitBoundsWithMaxZoom:{value:function(e,t){var r=this,n=new google.maps.LatLngBounds(e.sw,e.ne),a=new google.maps.MaxZoomService;a.getMaxZoomAtLatLng(n.getCenter(),function(n){return"OK"!==n.status?void r._fitAdaptedBounds(e,t):n.zoom<t?void r._fitAdaptedBounds(e,n.zoom):void r._fitAdaptedBounds(e,t)})}},_fitAdaptedBounds:{value:function(e,t){var r=this;google.maps.event.addListenerOnce(this.map,"zoom_changed",function(){window.requestAnimationFrame(function(){r.getZoom()>t&&r.setZoom(t),r.trigger("bounds_fitted")})}),this.fitBounds(e)}},setZoom:{value:function(e){this.map.setZoom(e)}},getZoom:{value:function(){return this.map.getZoom()}},setCenter:{value:function(e){this.map.setCenter(e)}},getCenter:{value:function(){var e=this.map.getCenter();return!!e&&{lat:e.lat(),lng:e.lng()}}},getBounds:{value:function(){var e=this.map.getBounds();if(e){var t=e.getSouthWest(),r=e.getNorthEast();return{sw:{lat:t.lat(),lng:t.lng()},ne:{lat:r.lat(),lng:r.lng()}}}return!1}},addLayer:{value:function(e){e.setMap(this.map)}},removeLayer:{value:function(e){e.setMap(null)}},drawCarMarker:{value:function(e,t){var r=new google.maps.OverlayView;return _.extend(r,{onAdd:function(){this.$div=$(t);var e=this.getPanes();this.$div.appendTo(e.floatPane)},draw:function(){var t=new google.maps.LatLng(e.lat,e.lng),r=this.getProjection().fromLatLngToDivPixel(t);this.$div.css({left:r.x-this.$div.width()/2,top:r.y-this.$div.height()/2})},onRemove:function(){this.$div.remove(),this.$div=null}}),r.setMap(this.map),this.carMarkers||(this.carMarkers=[]),this.carMarkers.push(r),r}},addClassToCarMarker:{value:function(e,t){e&&e.$div&&t&&e.$div.addClass(t)}},removeClassFromCarMarker:{value:function(e,t){e&&e.$div&&t&&e.$div.removeClass(t)}},removeCarMarker:{value:function(e){e.setMap(null),this.carMarkers&&this.carMarkers.splice(_.indexOf(this.carMarkers,e),1)}},removeCarMarkers:{value:function(){if(this.carMarkers){for(var e=0,t=this.carMarkers.length;e<t;e++)this.carMarkers[e].setMap(null);this.carMarkers=[]}}},loadMarkerWithLabel:{value:function(){return MapScriptLoader.loadJs(this.config.markerwithlabelscript)}},drawLandmark:{value:function(e,t){var r;return r=e.name?this._drawLandmarkWithCaption(e,t):this._drawLandmarkNoCaption(e),this.landmarks||(this.landmarks=[]),this.landmarks.push(r),this.isShowLandmark||r.setVisible(!1),"string"==typeof e.infoWindow&&this.setInfoWindowToMarker(r,e.infoWindow),r}},_drawLandmarkWithCaption:{value:function(e,t){var r="string"==typeof e.infoWindow,n=this._getIconSize(e.iconSize),a={position:new google.maps.LatLng(e.position.lat,e.position.lng),labelContent:e.name,icon:this._getIcon(e,e.iconSize),clickable:r,zIndex:e.zIndex,labelZindex:e.zIndex+1,labelAnchor:new google.maps.Point(0,-n[1]/2),labelStyle:{transform:"translate(-50%, 0)"}};t&&(a.labelClass=t),e.zIndex||(e.zIndex=0);var o=new MarkerWithLabel(a);return o.setMap(this.map),o}},_drawLandmarkNoCaption:{value:function(e){var t=new google.maps.Marker({position:new google.maps.LatLng(e.position.lat,e.position.lng),icon:this._getIcon(e,e.iconSize)});return t.setMap(this.map),t}},_getIcon:{value:function(e,t){return t=this._getIconSize(t),{url:e.iconUrl,scaledSize:new google.maps.Size(t[0],t[1]),anchor:new google.maps.Point(t[0]/2,t[1]/2)}}},_getIconSize:{value:function(e){return e?_.isNumber(e)?[e,e]:_.isArray(e)?0===e.length?this.DEFAULT_ICON_SIZE:1===e.length?_.isNumber(e[0])?[e[0],e[0]]:this.DEFAULT_ICON_SIZE:(e=e.slice(0,2),e.forEach(function(e){if(!_.isNumber(e))return this.DEFAULT_ICON_SIZE}),e):this.DEFAULT_ICON_SIZE:this.DEFAULT_ICON_SIZE}},setInfoWindowToMarker:{value:function(e,t){var r=new google.maps.InfoWindow({content:t});google.maps.event.addListener(e,"click",function(){r.open(this.map,this)})}},removeLandmark:{value:function(e){e.setMap(null)}},removeLandmarks:{value:function(){this.landmarks&&(this.landmarks.forEach(function(e){e.setMap(null)}),this.landmarks=[])}},toggleShowLandmarks:{value:function(e){this.isShowLandmark="undefined"!=typeof e?e:!this.isShowLandmark,this.isShowLandmark?this._showLandMarks():this._hideLandMarks()}},_hideLandMarks:{value:function(){this.landmarks.forEach(function(e){e.setVisible(!1)})}},_showLandMarks:{value:function(){this.landmarks.forEach(function(e){e.setVisible(!0)})}},createAreaOverlays:{value:function(e,t){var r=this;if(!e)return[];var n=e.map(function(e){var n=r._createAreaOverlay(e,t);return r._pushToAreaObjects(n,e),{overlay:n,data:e}});return n}},createAreaOverlay:{value:function(e,t){if(e){var r=this._createAreaOverlay(e,t);return this._pushToAreaObjects(r,e),{overlay:r,data:e}}}},_pushToAreaObjects:{value:function(e,t){this.areaObjects||(this.areaObjects=[]),this.areaObjects.push({overlay:e,data:t})}},_createAreaOverlay:{value:function(e){var t=void 0===arguments[1]?{}:arguments[1];if("polygon"===e.type||"rectangle"===e.type){var r,n=_.clone(t);if(e.style&&_.extend(n,e.style),"undefined"!=typeof e.editable&&(n.editable=e.editable,n.draggable=e.editable),"polygon"===e.type&&(r=this._createPolygonOverlay(e,n),e.editable&&this._setPolygonChangedEvents(r)),"rectangle"===e.type&&(r=this._createRectangleOverlay(e,n),e.editable&&this._setRectangleChangedEvents(r)),!e.infoWindow)return r;var a=function(){return!!e.editable||(void 0===e.clickable||e.clickable)}();if(r._infowindow=null,a&&google.maps.event.addListener(r,"click",function(t){r._infowindow&&r._infowindow.close(),r._infowindow=new google.maps.InfoWindow({content:e.infoWindow,position:t.latLng,maxWidth:200,disableAutoPan:e.infoWindowAutoPan===!1}),r._infowindow.open(this.map)}),e.showInfoWindowDefault){var o=this._getOverlayNorthernmostPoint(r);r._infoWindow=new google.maps.InfoWindow({content:e.infoWindow,position:o,maxWidth:200,disableAutoPan:e.infoWindowAutoPan===!1}),r._infoWindow.open(this.map)}return r}}},_getOverlayNorthernmostPoint:{value:function(e){if(e instanceof google.maps.Rectangle){var t=e.getBounds();return new google.maps.LatLng(t.getNorthEast().lat(),t.getSouthWest().lng())}var r=e.getPath().getArray(),n=r.map(function(e){return e.lat()}),a=_.max(n),o=r.filter(function(e){return e.lat()===a});return _.min(o,function(e){return e.lng()})}},_createPolygonOverlay:{value:function(e){var t=void 0===arguments[1]?{}:arguments[1],r=e.points.map(function(e){return new google.maps.LatLng(e[0],e[1])}),n=new google.maps.Polygon(_.extend({paths:r,clickable:e.clickable},t)),a=this;return google.maps.event.addListener(n,"rightclick",function(e){var t=this.getPath(),r=[];t.forEach(function(t,n){t.lat()===e.latLng.lat()&&t.lng()===e.latLng.lng()||r.push(t)}),0===r.length?n.setMap(null):this.setOptions({paths:r}),a.trigger(a.AREAS_CHANGED),a._setPolygonChangedEvents(this)}),n}},_setPolygonChangedEvents:{value:function(e){var t=this;e.isDispatch=!0,e.getPaths().forEach(function(r,n){google.maps.event.addListener(r,"insert_at",function(){t.trigger(t.AREAS_CHANGED)}),google.maps.event.addListener(r,"remove_at",function(){t.trigger(t.AREAS_CHANGED)}),google.maps.event.addListener(r,"set_at",function(){e.isDispatch&&t.trigger(t.AREAS_CHANGED)})}),google.maps.event.addListener(e,"dragstart",function(){this.isDispatch=!1}),google.maps.event.addListener(e,"dragend",function(){this.isDispatch=!0,t.trigger(t.AREAS_CHANGED)})}},_createRectangleOverlay:{value:function(e,t){if(e.bounds){var r=new google.maps.LatLngBounds(e.bounds.sw,e.bounds.ne);return new google.maps.Rectangle(_.extend({bounds:r},t))}var n=google.maps.geometry.spherical.computeOffset,a=new google.maps.LatLng(e.center.lat,e.center.lng),o=e.northSouth/2,i=e.eastWest/2,s=n(a,o,0),l=n(a,o,180),u=n(a,i,90),c=n(a,i,-90),p=new google.maps.LatLng(l.lat(),c.lng()),g=new google.maps.LatLng(s.lat(),u.lng()),r=new google.maps.LatLngBounds(p,g),d=new google.maps.Rectangle(_.extend({bounds:r,clickable:e.clickable},t));return d}},_setRectangleChangedEvents:{value:function(e){var t=this;e.isDispatch=!0,google.maps.event.addListener(e,"bounds_changed",function(){this.isDispatch&&t.trigger(t.AREAS_CHANGED)}),google.maps.event.addListener(e,"dragstart",function(){this.isDispatch=!1}),google.maps.event.addListener(e,"dragend",function(){this.isDispatch=!0,t.trigger(t.AREAS_CHANGED)})}},_prepareDrawingManger:{value:function(e,t){var r={drawingControl:!1,drawingMode:e,rectangleOptions:t,polygonOptions:t};return this.drawingManager?void this.drawingManager.setOptions(r):void(this.drawingManager=new google.maps.drawing.DrawingManager(r))}},setDrawMode:{value:function(e,t){var r=this;this._prepareDrawingManger(e,t);var n=function(){return"rectangle"===e?"rectanglecomplete":"polygoncomplete"}();google.maps.event.clearListeners(this.drawingManager,"polygoncomplete"),google.maps.event.clearListeners(this.drawingManager,"rectanglecomplete"),this.drawListener=google.maps.event.addListener(this.drawingManager,n,function(t){r._onAddDrawnShap(t,e)}),this.drawingManager.setMap(this.map)}},_onAddDrawnShap:{value:function(e,t){this._pushToAreaObjects(e,{type:t,editable:!1}),this.trigger("addShape",{overlay:e,data:{type:t,editable:!1}})}},unsetDrawMode:{value:function(){this.drawingManager&&(this.drawingManager.setDrawingMode(null),this.drawingManager.setMap(null))}},getAreasInfo:{value:function(){var e=this,t=[];return this.areaObjects.forEach(function(r){r.overlay.map&&t.push(e.getAreaInfo(r))}),t}},getAreaInfo:{value:function(e){return"rectangle"===e.data.type?this._getRectAreaInfo(e):this._getPolygonArea(e)}},_getRectAreaInfo:{value:function(e){var t=e.overlay,r=t.getBounds(),n=r.getCenter(),a=r.getNorthEast(),o=r.getSouthWest(),i=new google.maps.LatLng(a.lat(),o.lng()),s=google.maps.geometry.spherical.computeDistanceBetween(i,a),l=google.maps.geometry.spherical.computeDistanceBetween(i,o);return{type:"rectangle",center:{lat:n.lat(),lng:n.lng()},northSouth:l,eastWest:s,bounds:{ne:{lat:a.lat(),lng:a.lng()},sw:{lat:o.lat(),lng:o.lng()}},editable:e.data.editable,Desc:e.data.Desc,Expl:e.data.Expl}}},_getPolygonArea:{value:function(e){var t=e.overlay.getPaths().getAt(0),r=[];return t.forEach(function(e){r.push([e.lat(),e.lng()])}),{type:"polygon",points:r,editable:e.data.editable,Desc:e.data.Desc,Expl:e.data.Expl}}},getAreasBounds:{value:function(e){var t=[];return e.forEach(function(e){if(e.overlay.getBounds){var r=e.overlay.getBounds();t.push({lat:r.getSouthWest().lat(),lng:r.getSouthWest().lng()}),t.push({lat:r.getNorthEast().lat(),lng:r.getNorthEast().lng()})}else if(e.overlay.getPaths){var n=e.overlay.getPath();n.forEach(function(e){t.push({lat:e.lat(),lng:e.lng()})})}}),this.createBounds(t)}},drawRoute:{value:function(e,t,r,n){var a=this,o=void 0===arguments[4]?"DRIVING":arguments[4],i=google.maps.UnitSystem.METRIC;this.routeDeferred=$.Deferred(),this._resetRoute(),this.directionsService=new google.maps.DirectionsService,this.directionsDisplay=new google.maps.DirectionsRenderer({suppressMarkers:!0});var s=e.lat?new google.maps.LatLng(e.lat,e.lng):e,l=t.lat?new google.maps.LatLng(t.lat,t.lng):t;o=google.maps.TravelMode[o]?google.maps.TravelMode[o]:google.maps.TravelMode.DRIVING,n&&n.container instanceof HTMLElement&&(this.itineraryDom=n.container,this.directionsDisplay.setPanel(n.container),n.unitSystem&&"IMPERIAL"===n.unitSystem&&(i=google.maps.UnitSystem.IMPERIAL));var u={origin:s,destination:l,travelMode:o,unitSystem:i};return this.directionsService.route(u,function(e,t){if(t===google.maps.DirectionsStatus.OK){if(a._resetRoute(),!a.directionsDisplay)return void a.routeDeferred.resolve(a.ROUTE_SEARCH_CANCELD);a.directionsDisplay.setDirections(e),a.directionsDisplay.setMap(a.map),r.origin&&r.origin.show&&(a.routeOriginMarker=new google.maps.Marker(a._getPointMarkerIcon(e.routes[0].overview_path[0],r.origin.icon)),a.routeOriginMarker.setMap(a.map)),r.dest&&r.dest.show&&(a.routeDestMarker=new google.maps.Marker(a._getPointMarkerIcon(e.routes[0].overview_path[e.routes[0].overview_path.length-1],r.dest.icon)),a.routeDestMarker.setMap(a.map)),a.routeDeferred.resolve()}else t===google.maps.DirectionsStatus.NOT_FOUND?a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.NOT_FOUND,{status:MapWrapperError.routingErrorStatus.NOT_FOUND})):t===google.maps.DirectionsStatus.ZERO_RESULTS?a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.ZERO_RESULTS,{status:MapWrapperError.routingErrorStatus.ZERO_RESULTS})):t===google.maps.DirectionsStatus.MAX_WAYPOINTS_EXCEEDED?a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.MAX_WAYPOINTS_EXCEEDED,{status:MapWrapperError.routingErrorStatus.MAX_WAYPOINTS_EXCEEDED})):t===google.maps.DirectionsStatus.INVALID_REQUEST?a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.INVALID_REQUEST,{status:MapWrapperError.routingErrorStatus.INVALID_REQUEST})):t===google.maps.DirectionsStatus.REQUEST_DENIED?a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.REQUEST_DENIED,{status:MapWrapperError.routingErrorStatus.REQUEST_DENIED})):t===google.maps.DirectionsStatus.UNKNOWN_ERROR&&a.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.UNKNOWN,{status:MapWrapperError.routingErrorStatus.UNKNOWN}))}),this.routeDeferred.promise()}},_getPointMarkerIcon:{value:function(e,t){var r={},n={};return r.position=e,t&&t.url?(n.url=t.url,t.iconSize&&(n.size=new google.maps.Size(t.iconSize[0],t.iconSize[1])),t.anchor&&(n.anchor=new google.maps.Point(t.anchor[0],t.anchor[1])),r.icon=n,r):r}},_resetRoute:{value:function(){this.directionsDisplay&&this.directionsDisplay.setMap(null),this.routeOriginMarker&&this.routeOriginMarker.setMap(null),this.routeDestMarker&&this.routeDestMarker.setMap(null),this.itineraryDom&&(this.itineraryDom.innerHTML="")}},removeRoute:{value:function(){this.routeDeferred&&"pending"===this.routeDeferred.state()&&(this.directionsDisplay=null),this._resetRoute()}},getRouteSearchMethod:{value:function(){return Object.keys(google.maps.TravelMode)}},hasTrafficLayer:{value:function(){return!!google.maps.TrafficLayer}},createTrafficLayer:{value:function(){return this.trafficlayer&&this.removeLayer(this.trafficlayer),new google.maps.TrafficLayer}},loadMarkerClusterer:{value:function(){return MapScriptLoader.loadJs(this.config.clusterpluginscript)}},clusterMarkers:{value:function(e,t,r,n,a,o){var i=this;this.clearMarkers(),this.isShowCaption=!0,this.clusteMakerCaptionClass=o;for(var s=[],l=_.template(t),u=0,c=e.length;u<c;u++){(function(){var c=e[u],p=void 0;if(!c.latLng||!c.latLng.lat||!c.latLng.lng)return"continue";var g=c.MId;p=i._createMarkerInCluster(c,n,a,o,c.caption),p.originalIcon=p.getIcon(),t&&google.maps.event.addListener(p,"click",function(){i.clusterMarkerWindow&&i.clusterMarkerWindow.close(),i.clusterMarkerWindow=new google.maps.InfoWindow({content:l(c)}),i.clusterMarkerWindow.open(i.map,p),google.maps.event.addListener(i.clusterMarkerWindow,"domready",function(){_.forEach(r,function(e,t){$("#"+t+g).unbind(),$("#"+t+g).click(function(){e(c)})})})}),s[s.length+1]=p})()}var p=this.config.clustericondir?this.config.clustericondir.replace("//$/","")+"m":"//googlemaps.github.io/js-marker-clusterer/images/m",g=void 0!==this.options.maxClusterZoom?{maxZoom:this.options.maxClusterZoom}:{},d=_.extend({zoomOnClick:n,imagePath:p},g);this.cluster=new MarkerClusterer(this.map,s,d)}},markerClusterRedraw:{value:function(){var e=this.getCenter();this.setCenter({lat:e.lat+1e-4,lng:e.lng}),this.setCenter({lat:e.lat,lng:e.lng})}},_createMarkerInCluster:{value:function(e,t,r,n,a){var o;return o=r&&a?new MarkerWithLabel({position:e.latLng,labelClass:n,labelContent:a,clickable:t,labelAnchor:new google.maps.Point(0,(-2)),labelStyle:{transform:"translate(-50%, 0)"}}):new google.maps.Marker({position:e.latLng}),o.MId=e.MId,e.iconUrl&&o.setIcon({url:e.iconUrl}),o}},getMarkerInClusterByMId:{value:function(e){if(!this.cluster)return null;var t=this.cluster.getMarkers(),r=_.findIndex(t,function(t){return t.MId===e});return r===-1?null:t[r]}},toggleClusterMarkerCaption:{value:function(){this.isShowCaption=!this.isShowCaption,this.isShowCaption?$("."+this.clusteMakerCaptionClass).css("display",""):$("."+this.clusteMakerCaptionClass).css("display","none")}},setMarkerBlink:{value:function(e){return!!e&&(this.blinkMarkers||(this.blinkMarkers=[]),this.blinkMarkers.push(e),void(1===this.blinkMarkers.length&&this._markerBlink()))}},_markerBlink:{value:function(){var e=this;return!(!this.blinkMarkers||0===this.blinkMarkers.length)&&("undefined"==typeof this.blinkMarkerOpacity&&(this.blinkMarkerOpacity=1),this.blinkMarkerOpacity-=this.blinkMarkerV,this.blinkMarkerOpacity<.3?(this.blinkMarkerOpacity=.3,this.blinkMarkerV=-this.blinkMarkerV):this.blinkMarkerOpacity>1&&(this.blinkMarkerOpacity=1,this.blinkMarkerV=-this.blinkMarkerV),this.blinkMarkers.forEach(function(t){t.setOpacity(e.blinkMarkerOpacity)}),void window.requestAnimationFrame(function(){e._markerBlink()}))}},stopMarkerBlink:{value:function(e){if(!this.blinkMarkers||0===this.blinkMarkers.length)return!1;var t=_.indexOf(this.blinkMarkers,marker);return t!==-1&&(this.blinkMarkers.shift(t,1),void marker.setOpacity(1))}},stopAllMarkerBlink:{value:function(){return!(!this.blinkMarkers||0===this.blinkMarkers.length)&&(this.blinkMarkers.forEach(function(e){e.setOpacity(1)}),void(this.blinkMarkers=null))}},setTargetIcon:{value:function(e,t){e.setIcon({url:t}),this.targetMarkers.push(e)}},removeTargetIcon:{value:function(e){var t=_.indexOf(this.targetMarkers,e);t!==-1&&(e.setIcon(e.originalIcon),this.targetMarkers.shift(t,1))}},removeAllTargetIcons:{value:function(){this.targetMarkers.forEach(function(e){e.setIcon(e.originalIcon);
}),this.targetMarkers=[]}},clearMarkers:{value:function(){this.cluster&&this.cluster.clearMarkers()}},createBounds:{value:function(e){var t=new google.maps.LatLngBounds;e.forEach(function(e){t.extend(new google.maps.LatLng(e.lat,e.lng))});var r=t.getSouthWest(),n=t.getNorthEast();return{sw:{lat:r.lat(),lng:r.lng()},ne:{lat:n.lat(),lng:n.lng()}}}},redraw:{value:function(){this.trigger("resize")}},redrawRoute:{value:function(){this.redraw(),this.directionsDisplay&&this.directionsDisplay.map&&(this.directionsDisplay.setMap(null),this.directionsDisplay.setMap(this.map))}},addListener:{value:function(e,t){if(google.maps&&this.map)return google.maps.event.addListener(this.map,e,t)}},addListenerOnce:{value:function(e,t){google.maps&&this.map&&google.maps.event.addListenerOnce(this.map,e,t)}},removeAllListener:{value:function(e){google.maps&&this.map&&google.maps.event.clearListeners(this.map,e)}},changeCursor:{value:function(e){this.map.setOptions({draggableCursor:e})}},resetCursor:{value:function(){this.map.setOptions({draggableCursor:null})}},addMapClickListener:{value:function(e){return google.maps.event.addListener(this.map,"click",function(t){e({lat:t.latLng.lat(),lng:t.latLng.lng()})})}},removeMapClickListener:{value:function(e){google.maps.event.removeListener(e)}},trigger:{value:function(e,t){google.maps&&this.map&&google.maps.event.trigger(this.map,e,{data:t,type:e})}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},MapUtilties=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{R:{get:function(){return 6378137}},getRectangelBounding:{value:function(e,t,r){e=Number(e),t=Number(t),r.lat=Number(r.lat),r.lng=Number(r.lng);var n=6378137,a=e/2/n,o=r.lat+180*a/Math.PI,i=r.lat-180*a/Math.PI;o>90&&(o=180-o),i<-90&&(i=-180+i);var s=Math.abs(Math.cos(r.lat*Math.PI/180))*n,l=t/2/s,u=r.lng+180*l/Math.PI,c=r.lng-180*l/Math.PI;return u>180&&(u-=360),c<-180&&(c=360+c),{north:o,south:i,west:c,east:u}}},getDistanceBetweenPoints:{value:function(t,r){var n=t.lat*Math.PI/180,a=t.lng*Math.PI/180,o=r.lat*Math.PI/180,i=r.lng*Math.PI/180,s=e.R*Math.acos(Math.sin(n)*Math.sin(o)+Math.cos(n)*Math.cos(o)*Math.cos(i-a));return Math.round(s)}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},OpenStreetMapPlugin=function(){function e(t){_classCallCheck(this,e),this.AREAS_CHANGED="AREAS_CHANGED",this.ROUTE_SEARCH_CANCELD="ROUTE_SEARCH_CANCELD",this.DEFAULT_ICON_SIZE=[32,32],this.isShowLandmark=!0,this.config=t,this.blinkMarkerV=.02,this.LeafletEvents={bounds_changed:"moveend",center_changed:"moveend",zoom_changed:"zoomend",rightclick:"contextmenu"},this.targetMarkers=[],this.isEditing=!1}return _createClass(e,{loadApiScript:{value:function(){var e=this;return MapScriptLoader.loadJs(this.config.apiurl).then(function(){return MapScriptLoader.loadCss(e.config.apicss)}).then(function(){return $.when(MapScriptLoader.loadAllScripts(e.config.pluginscripts),MapScriptLoader.loadAllCss(e.config.plugincss))})}},Map:{value:function(e,t){void 0===arguments[2]?null:arguments[2];this.mapcanvasID=e;var r="//{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";"file:"===window.location.protocol&&(r="http:"+r);var n=new L.TileLayer(r,{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}),a={center:t.center,zoom:t.zoom,zoomControl:!1,layers:[n]};return(t.disableDefaultUI||t.staticMap)&&(a.zoomControl=!1,a.boxZoom=!1),(t.scrollwheel===!1||t.staticMap)&&(a.scrollWheelZoom=!1),(t.draggable===!1||t.staticMap)&&(a.dragging=!1),(t.disableDoubleClickZoom||t.staticMap)&&(a.doubleClickZoom=!1),this.map=L.map(e,a),this._setDefaultControl(t),this._setShapeChangeEvent(),this}},_setDefaultControl:{value:function(e){e.staticMap||(this.map.addControl(L.control.scale({position:"bottomright"})),e.disableDefaultUI&&!e.zoomControl||this._setZoomCtrl())}},_setZoomCtrl:{value:function(){var e=this;"undefined"!=typeof L.Control.Zoomslider?(this.zoomSlider=new L.Control.Zoomslider,this.map.addControl(this.zoomSlider),this._optimizeSlider(),this.map.on("resize",_.debounce(function(){e._optimizeSlider()},300))):this.map.addControl(new L.Control.Zoom)}},_optimizeSlider:{value:function(){this.zoomSlider&&(this.map.getSize().y<250?document.getElementsByClassName("leaflet-control-zoomslider-wrap")[0].style.display="none":document.getElementsByClassName("leaflet-control-zoomslider-wrap")[0].style.display="block")}},_setShapeChangeEvent:{value:function(){var e=this;L.Draw&&(this.map.on(L.Draw.Event.EDITVERTEX,function(){e.isEditing=!0,window.requestAnimationFrame(function(){e.isEditing=!1,e.trigger(e.AREAS_CHANGED)})}),this.map.on(L.Draw.Event.EDITRESIZE,function(){window.requestAnimationFrame(function(){e.trigger(e.AREAS_CHANGED)})}),this.map.on(L.Draw.Event.EDITMOVE,function(){window.requestAnimationFrame(function(){e.trigger(e.AREAS_CHANGED)})}))}},remove:{value:function(){this.map.getContainer()&&this.map.remove()}},fitBounds:{value:function(e){if("function"==typeof e.getSouth)this.map.fitBounds(e);else{var t=L.latLng(e.sw.lat,e.sw.lng),r=L.latLng(e.ne.lat,e.ne.lng);this.map.fitBounds(new L.latLngBounds(t,r))}}},fitBoundsWithMaxZoom:{value:function(e,t){var r=this;this.addListenerOnce("zoom",function(){return r.getZoom()>t?void r._fitAdaptedZoom(t):void r.trigger("bounds_fitted")}),this.fitBounds(e)}},_fitAdaptedZoom:{value:function(e){var t=this;this.setZoom(e),this.addListenerOnce("zoomend",function(){t.trigger("bounds_fitted")})}},setZoom:{value:function(e){this.map.setZoom(e)}},getZoom:{value:function(){return this.map.getZoom()}},setCenter:{value:function(e){this.map.setView(e)}},getCenter:{value:function(){var e=this.map.getCenter();return{lat:e.lat,lng:e.lng}}},getBounds:{value:function(){var e=this.map.getBounds();return{sw:{lat:e.getSouth(),lng:e.getWest()},ne:{lat:e.getNorth(),lng:e.getEast()}}}},addLayer:{value:function(e){this.map.addLayer(e)}},removeLayer:{value:function(e){this.map.removeLayer(e)}},drawCarMarker:{value:function(e,t){var r=L.divIcon({html:t,iconSize:["",""]}),n=new L.marker(e,{icon:r}).addTo(this.map),a=$(n._icon),o=a.width(),i=a.height();return r=L.divIcon({html:t,iconSize:["",""],iconAnchor:[o/2,i/2]}),n.setIcon(r),a.children().css({transform:"translateX(-50%) translateY(-50%) "}),this.carMarkers||(this.carMarkers=[]),this.carMarkers.push(n),n}},addClassToCarMarker:{value:function(e,t){e&&e._icon&&t&&e._icon.classList.add(t)}},removeClassFromCarMarker:{value:function(e,t){e&&e._icon&&t&&e._icon.classList.remove(t)}},removeCarMarker:{value:function(e){this.map.removeLayer(e),this.carMarkers&&this.carMarkers.splice(_.indexOf(this.carMarkers,e),1)}},removeCarMarkers:{value:function(){if(this.carMarkers){for(var e=0,t=this.carMarkers.length;e<t;e++)this.map.removeLayer(this.carMarkers[e]);this.carMarkers=[]}}},drawLandmark:{value:function(e,t){var r=L.marker([e.position.lat,e.position.lng],{icon:this._getIcon(e,t),zIndexOffset:1e3*e.zIndex});return this.landmarks||(this.landmarks=[]),this.landmarks.push(r),r.addTo(this.map),this.isShowLandmark||$(r._icon).css({display:"none"}),"string"==typeof e.infoWindow&&this.setInfoWindowToMarker(r,e.infoWindow),r}},_getIcon:{value:function(e,t){var r=this._getIconSize(e.iconSize);if(e.name){var n=L.divIcon({html:this._getLandMarkHTML(e.iconUrl,t,e.name,r),iconSize:["",""],iconAnchor:L.point(0,0)});return n}return new L.icon({iconUrl:e.iconUrl,iconSize:r,iconAnchor:L.point(r[0]/2,r[1]/2)})}},_getLandMarkHTML:{value:function(e,t,r,n){return'<img src="'+e+'" width="'+n[0]+'" height="'+n[1]+'" style="margin:-'+n[1]/2+"px 0 0 -"+n[0]/2+'px;"><div class="'+t+'" style="white-space:nowrap;position:absolute;top:'+(n[1]/2+5)+'px;transform:translate(-50%,0)">'+r+"</div>"}},_getIconSize:{value:function(e){return e?_.isNumber(e)?[e,e]:_.isArray(e)?0===e.length?this.DEFAULT_ICON_SIZE:1===e.length?_.isNumber(e[0])?[e[0],e[0]]:this.DEFAULT_ICON_SIZE:(e=e.slice(0,2),e.forEach(function(e){if(!_.isNumber(e))return this.DEFAULT_ICON_SIZE}),e):this.DEFAULT_ICON_SIZE:this.DEFAULT_ICON_SIZE}},setInfoWindowToMarker:{value:function(e,t){e.bindPopup(t,{maxHeight:this.map.getSize().y-60})}},removeLandmark:{value:function(e){this.map.removeLayer(e)}},removeLandmarks:{value:function(){var e=this;this.landmarks&&(this.landmarks.forEach(function(t){e.map.removeLayer(t)}),this.landmarks=[])}},toggleShowLandmarks:{value:function(e){this.isShowLandmark="undefined"!=typeof e?e:!this.isShowLandmark,this.isShowLandmark?this._showLandMarks():this._hideLandMarks()}},_hideLandMarks:{value:function(){this.landmarks.forEach(function(e){$(e._icon).css({display:"none"})})}},_showLandMarks:{value:function(){this.landmarks.forEach(function(e){$(e._icon).css({display:"block"})})}},createAreaOverlays:{value:function(e){var t=this,r=void 0===arguments[1]?{}:arguments[1];if(!e)return[];var n=!1,a=e.map(function(e){e.editable&&(n=!0);var a=t._createAreaOverlay(e,r);return t._pushToAreaObjects(a,e),{overlay:a,data:e}});return a}},createAreaOverlay:{value:function(e){var t=void 0===arguments[1]?{}:arguments[1];if(e){var r=this._createAreaOverlay(e,t);return this._pushToAreaObjects(r,e),{overlay:r,data:e}}}},_pushToAreaObjects:{value:function(e,t){this.areaObjects||(this.areaObjects=[]),this.areaObjects.push({overlay:e,data:t})}},_createAreaOverlay:{value:function(e){var t=void 0===arguments[1]?{}:arguments[1];if("polygon"===e.type||"rectangle"===e.type){var r,n=_.clone(t);e.style&&_.extend(n,e.style);var a={stroke:!0,color:n.strokeColor,weight:n.strokeWeight,opacity:n.strokeOpacity,fillColor:n.fillColor,fillOpacity:n.fillOpacity},o=function(){return!!e.editable||(void 0===e.clickable||e.clickable)}();if("polygon"===e.type&&(r=this._createPolygonOverlay(e,a)),"rectangle"===e.type&&(r=this._createRectangleOverlay(e,a)),!e.infoWindow)return r;r._infowindow=null;var i=e.infoWindow,s=this.map.getSize().y-60;if(o&&r.bindPopup(i,{maxHeight:s,autoPan:e.infoWindowAutoPan!==!1}),e.showInfoWindowDefault){var l=this._getOverlayNorthernWesternPoint(r),u=_.extend({maxHeight:s},{autoClose:!1,closeOnClick:!1,autoPan:e.infoWindowAutoPan!==!1});L.popup(u).setLatLng(l).setContent(i).openOn(this.map)}return r}}},_getOverlayNorthernWesternPoint:{value:function(e){if(e instanceof L.rectangle)return e.getBounds.getNorthWest();var t=e.getLatLngs()[0],r=_.max(t,function(e){return e.lat}).lat,n=_.filter(t,function(e){return e.lat===r});return _.min(n,function(e){return e.lng})}},_createPolygonOverlay:{value:function(e,t){var r=e.points.map(function(e){return L.latLng(e[0],e[1])}),n=L.polygon(r,t);return e.editable?(n.editing.enable(),n.editable=!0,n.on("dragstart",function(e){this.dragged=!0}),n.on("dragend",function(e,t){this.dragged||this.openPopup(e.target.getCenter()),this.dragged=!1}),n.addEventListener("click",function(){}),n):n}},_createRectangleOverlay:{value:function(e,t){var r=this,n=this,a=function(t){e.editable&&(t.editing.enable(),t.editable=!0,t.on("dragstart",function(e){this.dragged=!0}),t.on("dragend",function(e,t){this.dragged||this.openPopup(e.target.getCenter()),this.dragged=!1,n.trigger(n.AREAS_CHANGED)}),t.on("editstart",function(){r.isEditing=!0}),t.on("edit",function(){window.requestAnimationFrame(function(){r.isEditing=!1})}),t.addEventListener("click",function(){}))};if(e.bounds){var o=L.latLng(e.bounds.ne.lat,e.bounds.ne.lng),i=L.latLng(e.bounds.sw.lat,e.bounds.sw.lng),s=L.latLngBounds(o,i),l=L.rectangle(s,t);return a(l),l}var u=MapUtilties.getRectangelBounding(e.northSouth,e.eastWest,e.center),s=L.latLngBounds(L.latLng([u.south,u.west]),L.latLng([u.north,u.east])),l=new L.rectangle(s,t);return a(l),l}},_prepareDrwaMode:{value:function(e,t){var r={rectangle:{shapeOptions:t,handler:{tooltip:{start:"",cont:"",end:""}},repeatMode:!0},polygon:{shapeOptions:t,handler:{tooltip:{start:"",cont:"",end:""}},repeatMode:!0}};this.drawLayer||(this.drawLayer=new L.FeatureGroup,this.map.addLayer(this.drawLayer)),this.drawingManager||(this.drawingManager=new L.Control.Draw({edit:{featureGroup:this.drawLayer},draw:r}))}},setDrawMode:{value:function(e,t){var r=this;return t={color:t.strokeColor,weight:t.strokeWeight,opacity:t.strokeOpacity,fillColor:t.fillColor,fillOpacity:t.fillOpacity},this._prepareDrwaMode(e,t),this.map.removeEventListener("draw:created"),this.map.addEventListener("draw:created",function(t){r._onAddDrawnShap(t,e)},this),this.map.addControl(this.drawingManager),this.drawingManager._container.style.display="none","rectangle"===e?void this.drawingManager._toolbars[L.DrawToolbar.TYPE]._modes.rectangle.handler.enable():void("polygon"===e&&this.drawingManager._toolbars[L.DrawToolbar.TYPE]._modes.polygon.handler.enable())}},_onAddDrawnShap:{value:function(e,t){this.drawLayer&&(this.map.addLayer(e.layer),this._pushToAreaObjects(e.layer,{type:t,editable:!1}),this.trigger("addShape",{overlay:e.layer,data:{editable:!1,type:t}}))}},unsetDrawMode:{value:function(){this.drawingManager&&(this.drawingManager._toolbars[L.DrawToolbar.TYPE]._modes.rectangle.handler.disable(),this.map.removeControl(this.drawingManager),this.drawingManager=null)}},getRectangleInfo:{value:function(e){var t=e,r=t.getBounds(),n=(r.getCenter(),r.getNorthEast()),a=r.getSouthWest(),o=r.getNorthWest(),i=MapUtilties.getDistanceBetweenPoints(o,n),s=MapUtilties.getDistanceBetweenPoints(o,a);return{bounds:{ne:{lat:n.lat,lng:n.lng},sw:{lat:a.lat,lng:a.lng}},eastWest:i,northSouth:s}}},getAreasInfo:{value:function(){var e=this;if(this.areaObjects)var t=[];return this.areaObjects.forEach(function(r){r.overlay._map&&t.push(e.getAreaInfo(r))}),t}},getAreaInfo:{value:function(e){return"rectangle"===e.data.type?this._getRectAreaInfo(e):this._getPolygonArea(e)}},_getRectAreaInfo:{value:function(e){var t=e.overlay,r=t.getBounds(),n=r.getCenter(),a=r.getNorthEast(),o=r.getSouthWest(),i=r.getNorthWest(),s=MapUtilties.getDistanceBetweenPoints(i,a),l=MapUtilties.getDistanceBetweenPoints(i,o);return{type:"rectangle",center:{lat:n.lat,lng:n.lng},bounds:{ne:{lat:a.lat,lng:a.lng},sw:{lat:o.lat,lng:o.lng}},northSouth:l,eastWest:s,editable:e.data.editable,Desc:e.data.Desc,Expl:e.data.Expl}}},_getPolygonArea:{value:function(e){var t=e.overlay.getLatLngs()[0],r=t.map(function(e){return[e.lat,e.lng]});return{type:"polygon",points:r,editable:e.data.editable,Desc:e.data.Desc,Expl:e.data.Expl}}},getAreasBounds:{value:function(e){var t=[];return e.forEach(function(e){if(e.overlay.getBounds){var r=e.overlay.getBounds();t.push({lat:r.getSouth(),lng:r.getWest()}),t.push({lat:r.getNorth(),lng:r.getEast()})}else if(e.overlay.getLatLngs){var n=e.overlay.getLatLngs();n.forEach(function(e){t.push({lat:e.lat,lng:e.lng})})}}),this.createBounds(t)}},drawRoute:{value:function(e,t,r,n,a){var o=this,i="metric",s=$.Deferred(),l="//router.project-osrm.org/route/v1";"file:"===window.location.protocol&&(l="http:"+l),n&&n.container instanceof HTMLElement&&(this.itineraryDom=n.container,"IMPERIAL"===n.unitSystem&&(i="imperial"));var u=new L.Routing.osrmv1({serviceUrl:l,timeout:3e4});return this.routeSearchStopFlag=!1,this.route&&this._resetRoute(),this.route=L.Routing.control({router:u,addWaypoints:!1,waypoints:[L.latLng(e.lat,e.lng),L.latLng(t.lat,t.lng)],autoRoute:!1,createMarker:function(){return!1},showAlternatives:!1,lineOptions:{styles:[{color:"black",opacity:.15,weight:0},{color:"blue",opacity:.3,weight:8},{color:"blue",opacity:.5,weight:5}]},draggableWaypoints:!1}).addTo(this.map),$(".leaflet-routing-container").remove(),this.routeDeferred=s,this.route.addEventListener("routesfound",function(e){if(o.route.hasRoute=!0,o.routeSearchStopFlag)return o._resetRoute(),void o.routeDeferred.resolve(o.ROUTE_SEARCH_CANCELD);try{var t=o.route.getWaypoints();o._addRouteMarker(t[0].latLng,t[t.length-1].latLng,r),o._fitBoundsToRoute(e.routes[0]),n&&n.container instanceof HTMLElement&&o.itineraryDom.appendChild(o.getItineraryContent(e.routes[0],i)),o.routeDeferred.resolve()}catch(e){throw e}}),this.route.route(),this.route.addEventListener("routingerror",function(e){o.routeDeferred.reject(MapWrapperError.Error(MapWrapperError.routingErrorStatus.UNKNOWN,{status:MapWrapperError.routingErrorStatus.UNKNOWN}))}),s.promise()}},_fitBoundsToRoute:{value:function(e){this.fitBounds(L.latLngBounds(e.coordinates),{padding:[300,300]})}},getItineraryContent:{value:function(e,t){var r=new L.Routing.ItineraryBuilder,n=document.createElement("div"),a=r.createContainer(),o="en";this.config.lang&&L.Routing.Localization[this.config.lang]&&(o=this.config.lang);var i=new L.Routing.Formatter({language:o,units:t});return n.appendChild(this._getSummaryContent(e,i)),n.appendChild(a),a.appendChild(r.createStepsContainer(a)),e.instructions.forEach(function(e,t){a.appendChild(r.createStep(i.formatInstruction(e,t),i.formatDistance(e.distance),i.getIconName(e,t)))}),n}},_getSummaryContent:{value:function(e,t){var r=document.createElement("span"),n=document.createTextNode(t.formatDistance(e.summary.totalDistance)+", "+t.formatTime(e.summary.totalTime));return r.appendChild(n),r}},getRouteSearchMethod:{value:function(){return["DRIVING"]}},_resetRoute:{value:function(){if(this.route){var e=this.route.getWaypoints();this.route.spliceWaypoints(0,e.length),this.map.removeLayer(this.route),this.routeOriginMarker&&this.map.removeLayer(this.routeOriginMarker),this.routeDestMarker&&this.map.removeLayer(this.routeDestMarker),this.itineraryDom instanceof HTMLElement&&(this.itineraryDom.innerHTML="")}}},removeRoute:{value:function(){this.routeDeferred&&"pending"===this.routeDeferred.state()&&(this.routeSearchStopFlag=!0),this.route&&(this.route.hasRoute=!1,this._resetRoute())}},_addRouteMarker:{value:function(e,t,r){return r.origin.show&&(this.routeOriginMarker=L.marker(L.latLng(e.lat,e.lng),this._getPointMarkerIcon(r.origin.icon)).addTo(this.map)),r.dest.show&&(this.routeDestMarker=L.marker(L.latLng(t.lat,t.lng),this._getPointMarkerIcon(r.dest.icon)).addTo(this.map)),[this.routeOriginMarker,this.routeDestMarker]}},_getPointMarkerIcon:{value:function(e){var t,r={};return e&&e.url?(r.iconUrl=e.url,e.iconSize&&(r.iconSize=e.iconSize),e.anchor&&(r.iconAnchor=e.anchor),t=L.icon(r),{icon:t}):{}}},hasTrafficLayer:{value:function(){return!1}},loadMarkerClusterer:{value:function(){return $.when(MapScriptLoader.loadJs(this.config.clusterpluginscript),MapScriptLoader.loadCss(this.config.clusterplugincss))}},clusterMarkers:{value:function(e,t,r,n,a,o){this.clearMarkers(),this.isShowCaption=!0,this.clusteMakerCaptionClass=o,this.cluster=new PruneClusterForLeaflet;var i=this;this.cluster.PrepareLeafletMarker=function(e,t,n){if(t.icon&&("function"==typeof t.icon?e.setIcon(t.icon(t,n)):e.setIcon(t.icon)),t.popup){var a="function"==typeof t.popup?t.popup(t,n):t.popup;t.popupOptions||(t.popupOptions={},t.popupOptions.maxHeight=i.map.getSize().y-100),e.getPopup()?e.setPopupContent(a,t.popupOptions):e.bindPopup(a,t.popupOptions)}r&&e.on("popupopen",function(){$(".leaflet-popup").css("margin-bottom","30px"),_.forEach(r,function(e,r){$("#"+r+t.row.MId).unbind(),$("#"+r+t.row.MId).click(function(){e(t.row)})})})},n||(this.cluster.BuildLeafletCluster=function(e,t){var r=new L.Marker(t,{icon:i.cluster.BuildLeafletClusterIcon(e)});return r});for(var s,l,u=_.template(t),c=0,p=e.length;c<p;c++){var l=e[c];if(l.latLng){l.MId;s=new PruneCluster.Marker(l.latLng.lat,l.latLng.lng),s.data.row=l,s.MId=l.MId,s.captionClass=o,s.needCaptionMarker=this._getNeedCaptionMarker(l,a);var g=this._getNeedCaptionMarker(l,a);l.iconUrl||s.needCaptionMarker?s.data.icon=this._createIconInCluster(l,l.iconUrl,g,o):s.data.icon=new L.Icon.Default({className:"marker-icon_"+l.MId}),t&&(s.data.popup=u(l)),this.cluster.RegisterMarker(s)}}this.map.addLayer(this.cluster)}},markerClusterRedraw:{value:function(){this.cluster&&this.cluster.RedrawIcons()}},_getNeedCaptionMarker:{value:function(e,t){return!!t&&!!e.caption}},_createIconInCluster:{value:function(e,t,r,n){return r?this._createCaptionIcon(e,t,n):L.icon({className:"marker-icon_"+e.MId,iconUrl:t,iconAnchor:[18,42],iconSize:[36,42]})}},_createCaptionIcon:{value:function(e,t,r){return t?L.divIcon({className:"marker-icon_"+e.MId,html:'<img src="'+t+'"><div class="'+r+'" style="white-space:nowrap;position:absolute;top:42px;left:18px;transform:translate(-50%,0)">'+e.caption+"</div>",iconSize:["",""],iconAnchor:L.point(18,42)}):L.divIcon({className:"marker-icon_"+e.MId,html:'<img src="'+this.config.defaultIconImage+'" width="25" height="41"><div class="'+r+'" style="white-space:nowrap;position:absolute;top:41px;left:12.5px;transform:translate(-50%,0)">'+e.caption+"</div>",iconSize:["",""],iconAnchor:L.point(12.5,41)})}},getMarkerInClusterByMId:{value:function(e){if(!this.cluster)return null;var t=this.cluster.GetMarkers(),r=_.findIndex(t,function(t){return t.MId===e});return r===-1?null:t[r]}},toggleClusterMarkerCaption:{value:function(){this.isShowCaption=!this.isShowCaption,this.isShowCaption?$("."+this.clusteMakerCaptionClass).css("display",""):$("."+this.clusteMakerCaptionClass).css("display","none")}},setMarkerBlink:{value:function(e){return!!e&&(this.blinkMarkers||(this.blinkMarkers=[]),this.blinkMarkers.push(e),void(1===this.blinkMarkers.length&&this._markerBlink()))}},_markerBlink:{value:function(){var e=this;return!(!this.blinkMarkers||0===this.blinkMarkers.length)&&("undefined"==typeof this.blinkMarkerOpacity&&(this.blinkMarkerOpacity=1),this.blinkMarkerOpacity-=this.blinkMarkerV,this.blinkMarkerOpacity<.3?(this.blinkMarkerOpacity=.3,this.blinkMarkerV=-this.blinkMarkerV):this.blinkMarkerOpacity>1&&(this.blinkMarkerOpacity=1,this.blinkMarkerV=-this.blinkMarkerV),this.blinkMarkers.forEach(function(t){return t.setOpacity?void t.setOpacity(e.blinkMarkerOpacity):void $("."+t.data.icon.options.className).fadeTo(0,e.blinkMarkerOpacity)}),void window.requestAnimationFrame(function(){e._markerBlink()}))}},stopMarkerBlink:{value:function(e){if(!this.blinkMarkers||0===this.blinkMarkers.length)return!1;var t=_.indexOf(this.blinkMarkers,e);return t!==-1&&(this.blinkMarkers.shift(t,1),e.setOpacity?void e.setOpacity(1):void $("."+e.data.icon.options.className).fadeTo(0,1))}},stopAllMarkerBlink:{value:function(){return!(!this.blinkMarkers||0===this.blinkMarkers.length)&&(this.blinkMarkers.forEach(function(e){return e.setOpacity?void e.setOpacity(1):void $("."+e.data.icon.options.className).fadeTo(0,1)}),void(this.blinkMarkers=null))}},setTargetIcon:{value:function(e,t){e.data.icon=this._createIconInCluster(e.data.row,t,e.needCaptionMarker,e.captionClass),this.targetMarkers.push(e),e.data.forceIconRedraw=!0,this.cluster.ProcessView()}},removeTargetIcon:{value:function(e){var t=_.indexOf(this.targetMarkers,e);t!==-1&&(this._setDefaultIcon(e),this.targetMarkers.shift(t,1))}},removeAllTargetIcons:{value:function(){var e=this;this.targetMarkers&&(this.targetMarkers.forEach(function(t){e._setDefaultIcon(t)}),this.targetMarkers=[])}},_setDefaultIcon:{value:function(e){e.data.icon=this._createIconInCluster(e.data.row,e.data.row.iconUrl,e.needCaptionMarker,e.captionClass),e.data.forceIconRedraw=!0,this.cluster.ProcessView()}},clearMarkers:{value:function(){this.cluster&&(this.map.removeLayer(this.cluster),delete this.cluster)}},createBounds:{value:function(e){var t=[];e.forEach(function(e){t.push(L.latLng(e.lat,e.lng))});var r=L.latLngBounds(t);return{sw:{lat:r.getSouth(),lng:r.getWest()},ne:{lat:r.getNorth(),lng:r.getEast()}}}},redraw:{value:function(){this.map._onResize()}},redrawRoute:{value:function(){if(this.redraw(),this.route&&this.route.hasRoute){var e=this;setTimeout(function(){e._fitBoundsToRoute(e.route._routes[0])},50)}}},addListener:{value:function(e,t){L&&this.map&&(this.LeafletEvents[e]&&(e=this.LeafletEvents[e]),this.map.addEventListener(e,t))}},removeAllListener:{value:function(e){this.map&&this.map.removeEventListener(e)}},addListenerOnce:{value:function(e,t){L&&this.map&&(this.LeafletEvents[e]&&(e=this.LeafletEvents[e]),this.map.addOneTimeEventListener(e,t))}},changeCursor:{value:function(e){this.map.getContainer().style.cursor=e}},resetCursor:{value:function(){this.map.getContainer().style.cursor=null}},addMapClickListener:{value:function(e){var t=this,r=function(r){t.isEditing||e({lat:r.latlng.lat,lng:r.latlng.lng})};return this.map.addEventListener("click",r),r}},removeMapClickListener:{value:function(e){this.map.removeEventListener("click",e)}},trigger:{value:function(e,t){L&&this.map&&this.map.fireEvent(e,{data:t})}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},GeocodeError=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{Error:{value:function(e){var t=function(t,r){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e,t){var r=new Error(e);return _.extend(r,t),r})},errorStatus:{get:function(){return{ZERO_RESULTS:"ZERO_RESULTS",OVER_QUERY_LIMIT:"OVER_QUERY_LIMIT",REQUEST_DENIED:"REQUEST_DENIED",INVALID_REQUEST:"INVALID_REQUEST",UNKNOWN:"UNKNOWN",CONNECTION_FAILED:"CONNECTION_FAILED"}}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},Geocoder=function(){function e(t){var r=void 0===arguments[1]?{}:arguments[1];_classCallCheck(this,e),this.option=r,this._setPlugin(t)}return _createClass(e,{_setPlugin:{value:function(e){this.plugin=window[e]}},geocode:{value:function(e){return this.plugin.geocode(e,this.option)}},reverseGeocode:{value:function(e){return this.plugin.reverseGeocode(e,this.option)}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},GoogleGeocoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{reverseGeocode:{value:function(t,r){return MapScriptLoader.loadGoogleMapApiScript(r.apikey,r.lang,r.apiurl).then(function(){var r=$.Deferred(),n=new google.maps.Geocoder,a=new google.maps.LatLng(t.lat,t.lng);return n.geocode({latLng:a},function(t,n){if(n===google.maps.GeocoderStatus.OK){var o=e.findValidResponse(t,a);return o?void r.resolve(o.formatted_address):void r.reject(GeocodeError.Error(GeocodeError.errorStatus.ZERO_RESULTS,{origStatus:"",status:GeocodeError.errorStatus.ZERO_RESULTS}))}return n===google.maps.GeocoderStatus.ZERO_RESULTS?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.ZERO_RESULTS,{origStatus:n,status:GeocodeError.errorStatus.ZERO_RESULTS})):n===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.OVER_QUERY_LIMIT,{origStatus:n,status:GeocodeError.errorStatus.OVER_QUERY_LIMIT})):n===google.maps.GeocoderStatus.INVALID_REQUEST?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.INVALID_REQUEST,{origStatus:n,status:GeocodeError.errorStatus.REQUEST_DENIED})):n===google.maps.GeocoderStatus.REQUEST_DENIED?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.REQUEST_DENIED,{origStatus:n,status:GeocodeError.errorStatus.REQUEST_DENIED})):void r.reject(GeocodeError.Error(e.errorStatus.UNKNOWN,{origStatus:n,status:GeocodeError.errorStatus.UNKNOWN}))}),r.promise()})}},geocode:{value:function(t,r){return MapScriptLoader.loadGoogleMapApiScript(r.apikey,r.lang).then(function(){var r=$.Deferred(),n=new google.maps.Geocoder;return n.geocode({address:t},function(t,n){if(n===google.maps.GeocoderStatus.OK){var a=t[0].geometry.location;return void r.resolve({lat:a.lat(),lng:a.lng()})}return n===google.maps.GeocoderStatus.ZERO_RESULTS?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.ZERO_RESULTS,{origStatus:n,status:GeocodeError.errorStatus.ZERO_RESULTS})):n===google.maps.GeocoderStatus.OVER_QUERY_LIMIT?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.OVER_QUERY_LIMIT,{origStatus:n,status:GeocodeError.errorStatus.OVER_QUERY_LIMIT})):n===google.maps.GeocoderStatus.REQUEST_DENIED?void r.reject(GeocodeError.Error(GeocodeError.errorStatus.REQUEST_DENIED,{origStatus:n,status:GeocodeError.errorStatus.REQUEST_DENIED})):void r.reject(GeocodeError.Error(e.errorStatus.UNKNOWN,{origStatus:n,status:GeocodeError.errorStatus.UNKNOWN}))}),r.promise()})}},findValidResponse:{value:function(e,t){var r=function(e,t){return!!e&&e.contains(t)},n=function(e){return r(e.geometry.bounds,t)||r(e.geometry.viewport,t)},a=function(e){return 1===e.length&&"postal_code"===e[0]},o=function(e){return e.geometry.location_type!==google.maps.GeocoderLocationType.APPROXIMATE&&n(e)};if(o(e[0]))return e[0];var i=_.filter(e,function(e){return e.geometry.location_type===google.maps.GeocoderLocationType.APPROXIMATE}),s=_.find(i,function(e){return n(e)&&!a(e.types)});return s?s:_.find(e,function(e){return o(e)})}}}),e}(),_createClass=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},NominatimGeocoder=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,{geocode:{value:function(t){var r=$.Deferred(),n={q:t,format:"json"},a={data:n,url:e.URL+"search",jsonp:"json_callback"},o=$.ajax(a);return o.done(function(e){0===e.length?r.reject(GeocodeError.Error(GeocodeError.errorStatus.ZERO_RESULTS,{status:GeocodeError.errorStatus.ZERO_RESULTS})):r.resolve({lat:e[0].lat,lng:e[0].lon})}).fail(function(){r.reject(GeocodeError.Error(GeocodeError.errorStatus.CONNECTION_FAILED,{status:GeocodeError.errorStatus.CONNECTION_FAILED}))}),r.promise()}},reverseGeocode:{value:function(t){var r=$.Deferred(),n={lat:t.lat,lon:t.lng,format:"json"},a={data:n,url:e.URL+"reverse",jsonp:"json_callback"},o=$.ajax(a);return o.done(function(e){0===e.length?r.reject(GeocodeError.Error(GeocodeError.errorStatus.ZERO_RESULT,{status:GeocodeError.errorStatus.ZERO_RESULT})):r.resolve(e.display_name)}).fail(function(){r.reject(GeocodeError.Error(GeocodeError.errorStatus.CONNECTION_FAILED,{status:GeocodeError.errorStatus.CONNECTION_FAILED}))}),r.promise()}},URL:{get:function(){return"//nominatim.openstreetmap.org/"}}}),e}();