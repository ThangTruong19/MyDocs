<div id="cd-request-number-tab" *ngIf="labels && resource">
    <div class="row">
        <div class="col-12 row">
            <div class="col-4">
                <label style="display:inline-block; width: 35%">{{ resource.car_data_amount_upper_limit.name }}</label>

                <div style="display:inline-block; width: 65%">
                    <app-common-text
                        [itemName]="'car_data_amount_upper_limit'"
                        [itemParams]="params"
                        [showLabel]="false"
                        [type]="'number'"
                        [itemResource]="resource">
                    </app-common-text>
                </div>
            </div>
            <div class="col-8" style="line-height: 40px;">
                <button type="button" class="btn btn-primary btn-send" (click)="sendData()">{{ labels.expected_traffic_confirm }}</button>
                <div class="warning-mes" *ngIf="sumCarDataAmountUpperLimit > params['car_data_amount_upper_limit']">{{ labels.limit_over_message }}</div>
            </div>
        </div>
        <div class="col-12">
            <div class="app-table-options" [hidden]="count <= 0">
                <app-pagination
                    [count]="count"
                    [params]="pageParams"
                    [labels]="labels"
                    [element]="pageCountEl"
                    (changeState)="onPaginationChange()"
                >
                </app-pagination>
                <div class="table-option-buttons">
                    <div class="popover-wrapper">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        (click)="handleDiscardAllEdits()"
                      >
                        {{ labels.discard_all_edits_btn }}
                      </button>
                    </div>

                  </div>
            </div>
            <div class="app-table-wrapper">
                <app-common-table
                    [lists]="lists"
                    [thList]="thList"
                    [pageParams]="pageParams"
                    [isFetching]="isFetching"
                    [sortableThList]="sortableThList"
                    [(sortingParams)]="sortingParams"
                    [labels]="labels"
                    [customTableThContent]="customTableThContent"
                    [customTableRowContent]="customTableRowContent">

                    <ng-template #customTableThContent>
                        <th
                            class="th-request_number_car_identification_header_label app-index-th"
                            appSortingLabel
                            [(sortingParams)]="sortingParams"
                            [sortableThList]="sortableThList"
                            (sort)="onChangeSort($event)"
                            style="width: 25%;"
                        >
                            {{ labels.request_number_car_identification_header_label }}
                        </th>
                        <th
                            class="th-request_number_car_identification_header_label app-index-th"
                            appSortingLabel
                            [(sortingParams)]="sortingParams"
                            [sortableThList]="sortableThList"
                            (sort)="onChangeSort($event)"
                            style="width: 25%;"
                        >
                            {{ labels.request_number_customize_usage_definitions_header_label }}
                        </th>
                        <th class="app-index-td d-flex align-items-center"
                            style="width: 30%;">
                            {{ labels.request_number_customize_definitions_header_label }}
                        </th>
                        <th class="app-index-td d-flex align-items-center"
                            style="width: 10%;">
                            {{ labels.request_number_send_count_header_label }}
                        </th>
                        <th class="app-index-td d-flex align-items-center"
                            style="width: 10%;">
                            {{ labels.request_number_discard_edits_header_label }}
                        </th>
                    </ng-template>

                    <ng-template #customTableRowContent let-data="data" let-title="title" let-carIndex="idx">

                        <!-- 車両情報 -->
                        <td
                            class="td-request_number_car_identification_header_label app-index-td d-flex align-items-center"
                            style="width: 25%;"
                        >
                            <span>{{data['request_number_car_identification_id']}} - {{ data['request_number_car_identification_header_label'] }}</span>
                        </td>

                        <!-- カスタマイズ用途定義 -->
                        <td
                            class="td-request_number_customize_usage_definitions_header_label app-index-td align-items-center"
                            style="width: 25%; padding: 0!important;"
                        >
                            <ng-container *ngIf="data['request_number_customize_usage_definitions_header_label']" style="width: 100%;">
                                <div *ngIf="data['request_number_customize_usage_definitions_header_label'].length > 0" style="width: 100%;">
                                    <div *ngFor="let child of data['request_number_customize_usage_definitions_header_label']; let idx = index"
                                        style="padding: 6px;"
                                        [ngStyle]="getHigthCustomizeUsageDefinitions(child)"
                                        [ngClass]="idx > 0 ? 'border':''">
                                        <span class="link"
                                            (click)="handleCustomizeUsageDefinitionsClick(data, child, carIndex, idx)">{{ child.name }}</span>
                                    </div>
                                </div>
                            </ng-container>
                        </td>

                        <!-- カスタマイズ定義 -->
                        <td
                            class="align-items-center"
                            style="width: 30%; padding: 0!important; overflow: hidden;"
                        >
                            <ng-container *ngIf="data['request_number_customize_usage_definitions_header_label'].length > 0" style="width: 100%;">
                                <div *ngFor="let itemCustomizeUsageDefinitions of data['request_number_customize_usage_definitions_header_label']; let customizeUsageDefinitionsIndex = index"
                                    [ngStyle]="getHigthCustomizeDefinitionsLevel1(itemCustomizeUsageDefinitions)"
                                    [ngClass]="customizeUsageDefinitionsIndex > 0 ? 'border':''">

                                        <div *ngFor="let itemCustomizeDefinitions of itemCustomizeUsageDefinitions.customize_definitions; let customizeDefinitionsIndex = index"
                                            style="padding: 6px;"
                                            [ngStyle]="{height: rowHeight + 'px'}"
                                            [ngClass]="customizeDefinitionsIndex > 0 ? 'border':''">
                                            {{ itemCustomizeDefinitions.name }}
                                        </div>

                                </div>
                            </ng-container>
                        </td>
                        <!-- 送信件数 -->
                        <td
                            class="align-items-center text-center"
                            style="width: 10%; padding: 0; overflow: hidden;"
                        >
                            <ng-container *ngIf="data['request_number_customize_usage_definitions_header_label'].length > 0" style="width: 100%;">
                                <div *ngFor="let itemCustomizeUsageDefinitions of data['request_number_customize_usage_definitions_header_label']; let customizeUsageDefinitionsIndex = index"
                                    [ngStyle]="getHigthCustomizeDefinitionsLevel1(itemCustomizeUsageDefinitions)"
                                    [ngClass]="customizeUsageDefinitionsIndex > 0 ? 'border':''">
                                    <div *ngFor="let itemCustomizeDefinitions of itemCustomizeUsageDefinitions.customize_definitions; let customizeDefinitionsIndex = index"
                                        style="padding: 6px;"
                                        class="link"
                                        [ngStyle]="{height: rowHeight + 'px'}"
                                        [ngClass]="customizeDefinitionsIndex > 0 ? 'border':''"
                                        (click)="handleSendClick(data, customizeUsageDefinitionsIndex, customizeDefinitionsIndex)">
                                        <span *ngIf="itemCustomizeDefinitions.sends_no && itemCustomizeDefinitions.sends_no.length > 0">
                                            {{ itemCustomizeDefinitions.sends_no.length }}</span>
                                    </div>
                                </div>
                            </ng-container>
                        </td>
                        <!-- 編集破棄 -->
                        <td
                            class="align-items-center text-center"
                            style="width: 10%; padding: 0; overflow: hidden;"
                        >
                            <ng-container *ngIf="data['request_number_customize_usage_definitions_header_label'].length > 0" style="width: 100%;">
                                <div *ngFor="let itemCustomizeUsageDefinitions of data['request_number_customize_usage_definitions_header_label']; let customizeUsageDefinitionsIndex = index"
                                    [ngStyle]="getHigthCustomizeDefinitionsLevel1(itemCustomizeUsageDefinitions)"
                                    [ngClass]="customizeUsageDefinitionsIndex > 0 ? 'border':''">
                                    <div *ngFor="let itemCustomizeDefinitions of itemCustomizeUsageDefinitions.customize_definitions; let customizeDefinitionsIndex = index"
                                        style="padding: 6px;"
                                        class="app-sm-link"
                                        [ngStyle]="{height: rowHeight + 'px'}"
                                        [ngClass]="customizeDefinitionsIndex > 0 ? 'border':''"
                                        (click)="handleInputDataCancel(data, carIndex, customizeUsageDefinitionsIndex, customizeDefinitionsIndex)">
                                        <i class="app-icon app-icon-discard"></i>
                                    </div>
                                </div>
                            </ng-container>
                        </td>

                    </ng-template>
                </app-common-table>
            </div>
        </div>
        <div class="col-12 text-center" style="margin-top: 10px;">
            <button type="button" class="btn btn-primary" (click)="expectedTrafficConfirm()">{{ labels.data_send_request_btn }}</button>
        </div>
    </div>
</div>

<ng-template #cdExpectedTrafficConfirmModalContent>
    <div class="model-header">
        <p class="model-title">{{ labels.expected_traffic_confirm_message }}</p>
    </div>
    <app-cd-expected-traffic-confirm [thList]="thListRequestNumber" [data]="data" [labels]="labels">
    </app-cd-expected-traffic-confirm>
</ng-template>

<ng-template #cdRequestNumberListModalContent>
    <app-cd-request-number-list
        [resources]="resources"
        [carId]="carId"
    ></app-cd-request-number-list>
</ng-template>
<ng-template #cdRequestNumberSelectListModalContent>
    <app-cd-request-number-select-list
        [thList]="thListRequestNumberSelectList"
        [data]="listSendNo"
        [labels]="labels"
    ></app-cd-request-number-select-list>
</ng-template>
<ng-template #inputDataCancelConfirmModalContent>
    <app-input-data-cancel-confirm [labels]="labels">
    </app-input-data-cancel-confirm>
</ng-template>
<ng-template #inputDataAllCancelConfirmModalContent>
    <app-input-data-all-cancel-confirm [labels]="labels">
    </app-input-data-all-cancel-confirm>
</ng-template>
<ng-template #cdRequestNumberComfirmModalContent>
    <app-cd-request-number-comfirm
        [resources]="resources"
        [initThList]="this.cdRequestNumberConfirmThLists"
        [tableData]="listData"
        [maxTraffic]="params.car_data_amount_upper_limit"
    ></app-cd-request-number-comfirm>
</ng-template>
