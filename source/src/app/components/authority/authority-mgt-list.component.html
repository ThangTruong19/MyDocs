<section id="app-authority-mgt-list" *ngIf="labels && resource">
    <div class="container-fluid">
      <h2 class="app-page-title">{{ labels.title }}</h2>
      <div class="app-content">
        <!-- 一覧画面 -->
        <ng-container>
          <!-- 検索アコーディオン -->
          <app-accordion
            [collapsed]="collapsed"
            [useCustomHeader]="false"
            [title]="labels.search_condition"
            [labels]="labels"
            (onChangeState)="changePanelState($event)"
          >
            <div data-app-accordion-body>
              <div class="container app-search">
                <div class="row">

                <app-selected
                    class="col-sm-3"
                    *ngIf="resource.configuration_group_id"
                    [itemName]="'configuration_group_id'"
                    [itemParams]="params"
                    [itemResource]="resource"
                    >
                 </app-selected>

                <app-selected
                #belongingGroupId
                *ngIf="
                  resource.belonging_group_id &&
                  resource.belonging_group_id.values.length > 0
                "
                class="col-sm-3"
                [itemName]="'belonging_group_id'"
                [itemParams]="params"
                [itemResource]="resource"
              >
              </app-selected>

                <app-common-text
                    class="col-sm-3"
                    [itemName]="'user_account'"
                    [itemParams]="params"
                    [itemResource]="resource"
                    [maxlength]="255"
                  >
                  </app-common-text>

                  <app-common-text
                    class="col-sm-3"
                    [itemName]="'user_label'"
                    [itemParams]="params"
                    [itemResource]="resource"
                    [maxlength]="255"
                  >
                  </app-common-text>

                  <app-common-text
                    class="col-sm-3"
                    [itemName]="'phone_no'"
                    [itemParams]="params"
                    [itemResource]="resource"
                    [maxlength]="30"
                  >
                  </app-common-text>

                </div>
              </div>
              <div class="app-panel-footer">
                <button
                  (click)="onClickSearch()"
                  type="button"
                  class="btn btn-primary search"
                >
                  {{ labels.search }}
                </button>
              </div>
            </div>
          </app-accordion>

          <!-- 一覧テーブル上部検索オプション欄 -->
          <div class="app-table-options" [hidden]="count <= 0">
            <app-pagination
              [count]="count"
              [params]="pageParams"
              [labels]="labels"
              [element]="pageCountEl"
              (changeState)="onPaginationChange()"
            >
            </app-pagination>

            <div class="table-option-buttons">
              <div class="popover-wrapper">
                <button
                  type="button"
                  class="btn btn-secondary"
                  (click)="onClickFieldSelect($event)"
                >
                  {{ labels.field_select }}
                </button>
                <app-popover
                  [labels]="labels"
                  [resource]="fieldResources"
                  [fields]="fields"
                  [title]="labels.field_select_title"
                  [(isVisible)]="fieldSelectPopoverVisible"
                  (ok)="onFieldSelectOk($event)"
                >
                </app-popover>
              </div>

            </div>
          </div>

          <!-- 一覧テーブル -->
          <div class="app-table-wrapper">
            <app-common-table
            [customTableThContent]="customTableThContent"
            [customTableRowContent]="customTableRowContent"
            [lists]="lists"
            [pageParams]="pageParams"
            [thList]="thList"
            [sortableThList]="sortableThList"
            [(sortingParams)]="sortingParams"
            [labels]="labels"
            [collapsed]="collapsed"
            [isFetching]="isFetching"
            (sort)="onChangeSort($event)"
            >
            </app-common-table>
          </div>
        </ng-container>
      </div>
    </div>
  </section>

  <ng-template #customTableThContent>
    <ng-container *ngFor="let th of thList">
      <th
        *ngIf="th.displayable"
        class="app-index-th th-{{ th.shortName }}"
        appSortingLabel
        [ngClass]="{ 'disable-sort': !th.sortable }"
        [(sortingParams)]="sortingParams"
        [labelName]="th.sortKey || th.name"
        [sortableThList]="sortableThList"
        (sort)="onChangeSort($event)"
      >
        <span>{{ th.label || labels[th.shortName] }}</span>
      </th>
    </ng-container>
  </ng-template>

  <ng-template #customTableRowContent let-data="data" let-title="title" let-idx="idx">
    <ng-container *ngFor="let title of thList">
      <ng-container [ngSwitch]="title.name" *ngIf="title.displayable">
        <td
        *ngSwitchCase="'users.group.configuration_groups.label'"
        class="td-{{
          title.shortName
        }} app-index-td d-flex align-items-center"
      >
      {{ data | at: 'users.group.configuration_groups.label' }}
        </td>
       <td
       *ngSwitchCase="'users.group.granted_role.name'"
            class="td-{{
              title.shortName
            }} app-index-td d-flex align-items-center select-authority-cell"
          >
        <app-authority-select
          [authorities]="authorities"
          [labels]="labels"
          [selectedUser]="data"
          [selectedAuthorities]="selectedAuthorities"
          [customSelectButtons]="customSelectButtons"
          [customSelectedAuthorities]="customSelectedAuthorities"
          [allowUnselectedAuthorities]="true"
          (select)="onCloseAuthoritySelectModal($event, data)"
        ></app-authority-select>
        <span>
          <a
            class="select-authority"
            href="javascript:void(0)"
            (click)="onClickSelect(data, idx)"
          >
         {{ data | at: 'users.group.granted_role.name' }}
         </a>
         </span>
        </td>
        <td
        *ngSwitchDefault
          class="td-{{ title.shortName }} app-index-td d-flex align-items-center"
        >
          <span>{{ data[title.name] }}</span>
        </td>
      </ng-container>
    </ng-container>
  </ng-template>

  <app-alert></app-alert>

  <ng-template #customSelectButtons> </ng-template>

  <ng-template #customSelectedAuthorities> </ng-template>

  <ng-template #deleteModalContent>
    <app-custom-user-form-modal
      class="confirm-modal-content"
      [desc]="deleteModalValues.listDesc"
      [val]="deleteModalValues.listVal"
    >
    </app-custom-user-form-modal>
  </ng-template>

  <app-sidemenu [isLoading]="isLoading"></app-sidemenu>
